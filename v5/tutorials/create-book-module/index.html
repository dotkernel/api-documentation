<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="description" content="Dotkernel API">
        
        

        
        
            
        
        <meta name="docsearch:version" content="6.0.0,latest">
        <meta name="docsearch:language" content="en">
        <meta name="docsearch:component" content="api">

        
        <link rel="canonical" href="https://docs.dotkernel.org/api-documentation/v5/tutorials/create-book-module/">
        
        <link rel="shortcut icon" href="https://docs.dotkernel.org/img/dk_docs_favicon_white.svg">

        <title>Creating a book module - api - Dotkernel Documentation</title>

        <link rel="stylesheet" href="https://docs.dotkernel.org/css/bootstrap.css">
        <link rel="stylesheet" href="https://docs.dotkernel.org/css/bootstrap-icons.min.css">
        <link rel="stylesheet" href="https://docs.dotkernel.org/css/docs.css">
        <script src="https://docs.dotkernel.org//js/bootstrap.js" defer></script>
        <script src="https://docs.dotkernel.org//js/docs.js" defer></script>
        <script src="https://docs.dotkernel.org//js/scripts.js" defer></script>
    </head>
    <body data-bs-spy="scroll" data-bs-target=".toc" data-bs-offset="100">

        
        <nav class="navbar navbar-expand-lg bg-body-tertiary bg-light dk-nav py-3" data-bs-theme="light">
    <div class="container justify-content-between">
        <div class="dk-nav-icon d-flex align-items-center">
            <a class="navbar-brand" href="https://docs.dotkernel.org/">
                <img alt="Dotkernel Logo" class="d-inline-block align-text-top" height="50"
                     src="https://docs.dotkernel.org//img/dk_logomark_white.svg" width="45"/>
            </a>

            <div class="dk-nav-icon-items">
                <span style="font-size: 12px; line-height: 13px">Dotkernel Documentation</span>

                <div class="dropdown" data-bs-theme="light">
                    <span class="fw-bold dropdown-toggle dk-pkg-name" data-bs-toggle="dropdown" aria-expanded="false">API</span>
                    <ul class="dropdown-menu">
                        
                        <li class="dropdown-item bg-light">
                            <a href="https://docs.dotkernel.org/api-documentation/" class="nav-link d-flex gap-4 align-items-center">
                                <img alt="Dotkernel Logo" class="d-inline-block align-text-top" height="50" src="https://docs.dotkernel.org/img/dk_logomark.svg" width="45" />
                                <div>
                                    <span class="fw-bold d-block">API</span>
                                    <span>Dotkernel API</span>
                                </div>
                            </a>
                        </li>
                        
                        <li class="dropdown-item ">
                            <a href="https://docs.dotkernel.org/admin-documentation/" class="nav-link d-flex gap-4 align-items-center">
                                <img alt="Dotkernel Logo" class="d-inline-block align-text-top" height="50" src="https://docs.dotkernel.org/img/dk_logomark.svg" width="45" />
                                <div>
                                    <span class="fw-bold d-block">Admin</span>
                                    <span>Dotkernel Admin</span>
                                </div>
                            </a>
                        </li>
                        
                        <li class="dropdown-item ">
                            <a href="https://docs.dotkernel.org/frontend-documentation/" class="nav-link d-flex gap-4 align-items-center">
                                <img alt="Dotkernel Logo" class="d-inline-block align-text-top" height="50" src="https://docs.dotkernel.org/img/dk_logomark.svg" width="45" />
                                <div>
                                    <span class="fw-bold d-block">Frontend</span>
                                    <span>Dotkernel Frontend</span>
                                </div>
                            </a>
                        </li>
                        
                        <li class="dropdown-item ">
                            <a href="https://docs.dotkernel.org/light-documentation/" class="nav-link d-flex gap-4 align-items-center">
                                <img alt="Dotkernel Logo" class="d-inline-block align-text-top" height="50" src="https://docs.dotkernel.org/img/dk_logomark.svg" width="45" />
                                <div>
                                    <span class="fw-bold d-block">Light</span>
                                    <span>Dotkernel Light</span>
                                </div>
                            </a>
                        </li>
                        
                        <li class="dropdown-item ">
                            <a href="https://docs.dotkernel.org/packages/" class="nav-link d-flex gap-4 align-items-center">
                                <img alt="Dotkernel Logo" class="d-inline-block align-text-top" height="50" src="https://docs.dotkernel.org/img/dk_logomark.svg" width="45" />
                                <div>
                                    <span class="fw-bold d-block">Packages</span>
                                    <span>Dotkernel packages</span>
                                </div>
                            </a>
                        </li>
                        
                        <li class="dropdown-item ">
                            <a href="https://docs.dotkernel.org/development/" class="nav-link d-flex gap-4 align-items-center">
                                <img alt="Dotkernel Logo" class="d-inline-block align-text-top" height="50" src="https://docs.dotkernel.org/img/dk_logomark.svg" width="45" />
                                <div>
                                    <span class="fw-bold d-block">Development</span>
                                    <span>WSL2 Development Environment</span>
                                </div>
                            </a>
                        </li>
                        
                    </ul>
                </div>
            </div>
        </div>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarText" aria-controls="navbarText" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarText">
            <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
<!--                <li class="nav-item">-->
<!--                    <a href="#" class="nav-link fw-bold text-white" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal" title="Open search">-->
<!--                        <i class="bi bi-search"></i> Search-->
<!--                    </a>-->
<!--                </li>-->
                <li class="nav-item">
                    <a class="nav-link fw-bold text-white" href="https://github.com/dotkernel/api" title="Go to api repository" target="_blank">
                        <i class="bi bi-github"></i>
                        GitHub
                    </a>
                </li>
                <li class="nav-item">
                    
    
    <div class="version-selector">
        <div class="btn-group">
            <button type="button" class="btn dropdown-toggle bg-light" data-toggle="dropdown" data-display="static" aria-haspopup="true" aria-expanded="false" id="version-selector-dropdown">
                
                    v5
                
            </button>
            <div class="dropdown-menu dropdown-menu-right dropdown-menu-lg-left" aria-labelledby="version-selector-dropdown">
                
                
                <a href="../../../v6/introduction/introduction/" class="dropdown-item">
                    
                        v6 (latest)
                    
                </a>
                
                
                
                <a href="../../introduction/introduction/" class="dropdown-item active">
                    
                        v5
                    
                </a>
                
                
                
                <a href="../../../v4/introduction/introduction/" class="dropdown-item">
                    
                        v4
                    
                </a>
                
                
            </div>
        </div>
    </div>
    

                </li>
            </ul>
        </div>
    </div>
</nav>

        
        <div class="container">
    <nav aria-label="breadcrumb" class="nav_breadcrumb">
        <ol class="breadcrumb">
            
                <li class="breadcrumb-item"><a href="https://docs.dotkernel.org/">Overview</a></li>
                

                
                    <li class="breadcrumb-item"><a href="../../..">api</a></li>

                    
                        
                            
                            
                        
                    
                        
                            
                            
                                <li class="breadcrumb-item">Tutorials</li>
                            
                        
                    

                    <li class="breadcrumb-item active" aria-current="page">Creating a book module</li>
                
            
        </ol>
    </nav>
</div>

        
        <div class="container">
            <div class="row">
                <div class="col-lg-3 right_sidebar">
                    
                    
    <div class="subnavigation hidden-print">
<!--        <h4 class="subnavigation__title">-->
<!--            <a href="../../..">api</a>-->
<!--        </h4>-->

        <h5 class="subnavigation__title">Table of Contents</h5>

        <ul class="subnavigation__list">
            

                
                

                    
                    
                
            

                
                
                    
                        
<li class="subnavigation__list-item ">
    <a href="../../introduction/introduction/" class="subnavigation__link">Introduction</a>
</li>

                    
                        



















<li class="subnavigation__list-item">
    <a data-bs-toggle="collapse" href="#overview" role="button" aria-expanded="false" aria-controls="overview">
        <span class="subnavigation__headline">Overview</span>
    </a>
    <ul class="subnavigation__list collapse" id="overview">
        
        
<li class="subnavigation__list-item ">
    <a href="../../introduction/server-requirements/" class="subnavigation__link">Server Requirements</a>
</li>

        
        
<li class="subnavigation__list-item ">
    <a href="../../introduction/file-structure/" class="subnavigation__link">File Structure</a>
</li>

        
        
<li class="subnavigation__list-item ">
    <a href="../../introduction/packages/" class="subnavigation__link">Packages</a>
</li>

        
        
<li class="subnavigation__list-item ">
    <a href="../../introduction/psr/" class="subnavigation__link">PSRs</a>
</li>

        
    </ul>
</li>

                    
                        



























<li class="subnavigation__list-item">
    <a data-bs-toggle="collapse" href="#installation" role="button" aria-expanded="false" aria-controls="installation">
        <span class="subnavigation__headline">Installation</span>
    </a>
    <ul class="subnavigation__list collapse" id="installation">
        
        
<li class="subnavigation__list-item ">
    <a href="../../installation/getting-started/" class="subnavigation__link">Getting Started</a>
</li>

        
        
<li class="subnavigation__list-item ">
    <a href="../../installation/composer/" class="subnavigation__link">Composer</a>
</li>

        
        
<li class="subnavigation__list-item ">
    <a href="../../installation/configuration-files/" class="subnavigation__link">Configuration Files</a>
</li>

        
        
<li class="subnavigation__list-item ">
    <a href="../../installation/doctrine-orm/" class="subnavigation__link">Doctrine ORM</a>
</li>

        
        
<li class="subnavigation__list-item ">
    <a href="../../installation/test-the-installation/" class="subnavigation__link">Test the Installation</a>
</li>

        
        
<li class="subnavigation__list-item ">
    <a href="../../installation/faq/" class="subnavigation__link">FAQ</a>
</li>

        
    </ul>
</li>

                    
                        





















<li class="subnavigation__list-item">
    <a data-bs-toggle="collapse" href="#upgrading" role="button" aria-expanded="false" aria-controls="upgrading">
        <span class="subnavigation__headline">Upgrading</span>
    </a>
    <ul class="subnavigation__list collapse" id="upgrading">
        
        
<li class="subnavigation__list-item ">
    <a href="../../upgrading/upgrading/" class="subnavigation__link">Upgrade procedure</a>
</li>

        
        
<li class="subnavigation__list-item ">
    <a href="../../upgrading/UPGRADE-5.3/" class="subnavigation__link">Upgrading 5.2 to 5.3</a>
</li>

        
    </ul>
</li>

                    
                        











<li class="subnavigation__list-item">
    <a data-bs-toggle="collapse" href="#flow" role="button" aria-expanded="false" aria-controls="flow">
        <span class="subnavigation__headline">Flow</span>
    </a>
    <ul class="subnavigation__list collapse" id="flow">
        
        
<li class="subnavigation__list-item ">
    <a href="../../flow/middleware-flow/" class="subnavigation__link">Middleware Flow</a>
</li>

        
        
<li class="subnavigation__list-item ">
    <a href="../../flow/default-library-flow/" class="subnavigation__link">Default Library Flow</a>
</li>

        
        
<li class="subnavigation__list-item ">
    <a href="../../flow/library-flow-for-email/" class="subnavigation__link">Library Flow for Email</a>
</li>

        
    </ul>
</li>

                    
                        





























<li class="subnavigation__list-item">
    <a data-bs-toggle="collapse" href="#core-features" role="button" aria-expanded="false" aria-controls="core-features">
        <span class="subnavigation__headline">Core Features</span>
    </a>
    <ul class="subnavigation__list collapse" id="core-features">
        
        
<li class="subnavigation__list-item ">
    <a href="../../core-features/authentication/" class="subnavigation__link">Authentication</a>
</li>

        
        
<li class="subnavigation__list-item ">
    <a href="../../core-features/authorization/" class="subnavigation__link">Authorization</a>
</li>

        
        
<li class="subnavigation__list-item ">
    <a href="../../core-features/content-validation/" class="subnavigation__link">Content Validation</a>
</li>

        
        
<li class="subnavigation__list-item ">
    <a href="../../core-features/exceptions/" class="subnavigation__link">Exceptions</a>
</li>

        
        
<li class="subnavigation__list-item ">
    <a href="../../core-features/dependency-injection/" class="subnavigation__link">Dependency Injection</a>
</li>

        
        
<li class="subnavigation__list-item ">
    <a href="../../core-features/error-reporting/" class="subnavigation__link">Error reporting</a>
</li>

        
    </ul>
</li>

                    
                        



















<li class="subnavigation__list-item">
    <a data-bs-toggle="collapse" href="#commands" role="button" aria-expanded="false" aria-controls="commands">
        <span class="subnavigation__headline">Commands</span>
    </a>
    <ul class="subnavigation__list collapse" id="commands">
        
        
<li class="subnavigation__list-item ">
    <a href="../../commands/create-admin-account/" class="subnavigation__link">Create admin account</a>
</li>

        
        
<li class="subnavigation__list-item ">
    <a href="../../commands/generate-database-migrations/" class="subnavigation__link">Generate database migrations</a>
</li>

        
        
<li class="subnavigation__list-item ">
    <a href="../../commands/display-available-endpoints/" class="subnavigation__link">Display available endpoints</a>
</li>

        
        
<li class="subnavigation__list-item ">
    <a href="../../commands/generate-tokens/" class="subnavigation__link">Generate tokens</a>
</li>

        
    </ul>
</li>

                    
                        





















<li class="subnavigation__list-item">
    <a data-bs-toggle="collapse" href="#tutorials" role="button" aria-expanded="false" aria-controls="tutorials">
        <span class="subnavigation__headline">Tutorials</span>
    </a>
    <ul class="subnavigation__list collapse" id="tutorials">
        
        
<li class="subnavigation__list-item ">
    <a href="../cors/" class="subnavigation__link">Setting up CORS</a>
</li>

        
        
<li class="subnavigation__list-item subnavigation__list-item--active">
    <a href="./" class="subnavigation__link">Creating a book module</a>
</li>

        
        
<li class="subnavigation__list-item ">
    <a href="../token-authentication/" class="subnavigation__link">Token authentication</a>
</li>

        
        
<li class="subnavigation__list-item ">
    <a href="../api-evolution/" class="subnavigation__link">API Evolution</a>
</li>

        
        
<li class="subnavigation__list-item ">
    <a href="../find-user-by-identity/" class="subnavigation__link">Find user by identity</a>
</li>

        
    </ul>
</li>

                    
                        





















































<li class="subnavigation__list-item">
    <a data-bs-toggle="collapse" href="#transition-from-api-tools" role="button" aria-expanded="false" aria-controls="transition-from-api-tools">
        <span class="subnavigation__headline">Transition from API Tools</span>
    </a>
    <ul class="subnavigation__list collapse" id="transition-from-api-tools">
        
        
<li class="subnavigation__list-item ">
    <a href="../../transition-from-api-tools/api-tools-vs-dotkernel-api/" class="subnavigation__link">Laminas API Tools vs Dotkernel API</a>
</li>

        
        
<li class="subnavigation__list-item ">
    <a href="../../transition-from-api-tools/transition-approach/" class="subnavigation__link">Transition Approach</a>
</li>

        
        
<li class="subnavigation__list-item ">
    <a href="../../transition-from-api-tools/discovery-phase/" class="subnavigation__link">Discovery Phase</a>
</li>

        
    </ul>
</li>

                    
                        

















<li class="subnavigation__list-item">
    <a data-bs-toggle="collapse" href="#openapi" role="button" aria-expanded="false" aria-controls="openapi">
        <span class="subnavigation__headline">OpenAPI</span>
    </a>
    <ul class="subnavigation__list collapse" id="openapi">
        
        
<li class="subnavigation__list-item ">
    <a href="../../openapi/introduction/" class="subnavigation__link">Introduction</a>
</li>

        
        
<li class="subnavigation__list-item ">
    <a href="../../openapi/initialized-components/" class="subnavigation__link">Initialized Components</a>
</li>

        
        
<li class="subnavigation__list-item ">
    <a href="../../openapi/write-documentation/" class="subnavigation__link">Write Documentation</a>
</li>

        
        
<li class="subnavigation__list-item ">
    <a href="../../openapi/generate-documentation/" class="subnavigation__link">Generate Documentation</a>
</li>

        
        
<li class="subnavigation__list-item ">
    <a href="../../openapi/render-documentation/" class="subnavigation__link">Render Documentation</a>
</li>

        
        
<li class="subnavigation__list-item ">
    <a href="../../openapi/use-documentation/" class="subnavigation__link">Use Documentation</a>
</li>

        
        
<li class="subnavigation__list-item ">
    <a href="../../openapi/getting-help/" class="subnavigation__link">Getting Help</a>
</li>

        
    </ul>
</li>

                    
                        





















<li class="subnavigation__list-item">
    <a data-bs-toggle="collapse" href="#reference" role="button" aria-expanded="false" aria-controls="reference">
        <span class="subnavigation__headline">Reference</span>
    </a>
    <ul class="subnavigation__list collapse" id="reference">
        
        
<li class="subnavigation__list-item ">
    <a href="../../reference/account-anonymization/" class="subnavigation__link">Anonymize Accounts</a>
</li>

        
    </ul>
</li>

                    
                
            

                
                

                    
                    
                
            
        </ul>
    </div>

                    

                    
                    
                    
    

    
    
        <div class="toc">
            <h6 class="toc__headline">On this page</h6>
            <ul class="toc__list">
            
                <li class="toc__entry">
                    <a href="#folder-and-files-structure" class="toc__link nav-link">Folder and files structure</a>
                </li>
            
                <li class="toc__entry">
                    <a href="#creating-and-configuring-the-module" class="toc__link nav-link">Creating and configuring the module</a>
                </li>
            
                <li class="toc__entry">
                    <a href="#file-creation-and-contents" class="toc__link nav-link">File creation and contents</a>
                </li>
            
                <li class="toc__entry">
                    <a href="#migrations" class="toc__link nav-link">Migrations</a>
                </li>
            
                <li class="toc__entry">
                    <a href="#checking-endpoints" class="toc__link nav-link">Checking endpoints</a>
                </li>
            
            </ul>
        </div>
    

                    
                </div>
                <div class="col-lg-9 main_docs">
                    
                    

    <div class="alert alert-danger alert-caution" role="alert">
        <p class="mb-0">
            The documentation you are viewing is for an older version of this component.<br>
            <a href="../../..">Switch to the latest (v6) version.</a>
        </p>
    </div>




    
    
<!--        <h2 class="chapter__headline text-black-50">Tutorials</h2>-->
    

    <h1 id="implementing-a-book-module-in-dotkernel-api">Implementing a book module in Dotkernel API</h1>
<h2 id="folder-and-files-structure">Folder and files structure</h2>
<p>The below files structure is what we will have at the end of this tutorial and is just an example, you can have multiple components such as event listeners, wrappers, etc.</p>
<pre class="highlight"><code class="language-markdown">.
└── src/
    └── Book/
        └── src/
            ├── Collection/
            │   └── BookCollection.php
            ├── Entity/
            │   └── Book.php
            ├── Handler/
            │   └── BookHandler.php
            ├── InputFilter/
            │   ├── Input/
            │   │   ├── AuthorInput.php
            │   │   ├── NameInput.php
            │   │   └── ReleaseDateInput.php
            │   └── BookInputFilter.php
            ├── Repository/
            │   └── BookRepository.php
            ├── Service/
            │   ├── BookService.php
            │   └── BookServiceInterface.php
            ├── ConfigProvider.php
            └── RoutesDelegator.php</code></pre>
<ul>
<li><code>src/Book/src/Collection/BookCollection.php</code> - a collection refers to a container for a group of related objects, typically used to manage sets of related entities fetched from a database</li>
<li><code>src/Book/src/Entity/Book.php</code> - an entity refers to a PHP class that represents a persistent object or data structure</li>
<li><code>src/Book/src/Handler/BookHandler.php</code> - handlers are middleware that can handle requests based on an action</li>
<li><code>src/Book/src/Repository/BookRepository.php</code> - a repository is a class responsible for querying and retrieving entities from the database</li>
<li><code>src/Book/src/Service/BookService.php</code> - is a class or component responsible for performing a specific task or providing functionality to other parts of the application</li>
<li><code>src/Book/src/ConfigProvider.php</code> -  is a class that provides configuration for various aspects of the framework or application</li>
<li><code>src/Book/src/RoutesDelegator.php</code> - a routes delegator is a delegator factory responsible for configuring routing middleware based on routing configuration provided by the application</li>
<li><code>src/Book/src/InputFilter/BookInputFilter.php</code> - input filters and validators</li>
<li><code>src/Book/src/InputFilter/Input/*</code> - input filters and validator configurations</li>
</ul>
<h2 id="creating-and-configuring-the-module">Creating and configuring the module</h2>
<p>Firstly we will need the book module, so we will implement and create the basics for a module to be registered and functional.</p>
<p>In <code>src</code> folder we will create the <code>Book</code> folder and in this we will create the <code>src</code> folder. So the final structure will be like this: <code>src/Book/src</code>.</p>
<p>In <code>src/Book/src</code> we will create 2 php files: <code>RoutesDelegator.php</code> and <code>ConfigProvider.php</code>. This files will be updated later with all needed configuration.</p>
<ul>
<li><code>src/Book/src/RoutesDelegator.php</code></li>
</ul>
<pre class="highlight"><code class="language-php">&lt;?php

namespace Api\Book;

use Mezzio\Application;
use Psr\Container\ContainerInterface;

class RoutesDelegator
{
    public function __invoke(ContainerInterface $container, string $serviceName, callable $callback): Application
    {
        /** @var Application $app */
        $app = $callback();

        return $app;
    }
}</code></pre>
<ul>
<li><code>src/Book/src/ConfigProvider.php</code></li>
</ul>
<pre class="highlight"><code class="language-php">&lt;?php

declare(strict_types=1);

namespace Api\Book;

use Mezzio\Application;
use Mezzio\Hal\Metadata\MetadataMap;

class ConfigProvider
{
    public function __invoke(): array
    {
        return [
            'dependencies'     =&gt; $this-&gt;getDependencies(),
            'doctrine'     =&gt; $this-&gt;getDoctrineConfig(),
             MetadataMap::class =&gt; $this-&gt;getHalConfig(),
        ];
    }

    private function getDependencies(): array
    {
        return [
            'delegators' =&gt; [
                Application::class =&gt; [
                    RoutesDelegator::class
                ]
            ],
            'factories' =&gt; [
            ],
            'aliases'   =&gt; [
            ],
        ];
    }

    private function getDoctrineConfig(): array
    {
        return [

        ];
    }

    private function getHalConfig(): array
    {
        return [

        ];
    }

}</code></pre>
<h3 id="registering-the-module">Registering the module</h3>
<ul>
<li>register the module config by adding the <code>Api\Book\ConfigProvider::class</code> in <code>config/config.php</code> under the <code>Api\User\ConfigProvider::class</code></li>
<li>register the namespace by adding this line <code>"Api\\Book\\": "src/Book/src/"</code>, in composer.json under the autoload.psr-4 key</li>
<li>update Composer autoloader by running the command:</li>
</ul>
<pre class="highlight"><code class="language-shell">composer dump-autoload</code></pre>
<p>That's it. The module is now registered and, we can continue creating Handlers, Services, Repositories and whatever is needed for out tutorial.</p>
<h2 id="file-creation-and-contents">File creation and contents</h2>
<p>Each file below have a summary description above of what that file does.</p>
<ul>
<li><code>src/Book/src/Collection/BookCollection.php</code></li>
</ul>
<pre class="highlight"><code class="language-php">&lt;?php

declare(strict_types=1);

namespace Api\Book\Collection;

use Api\App\Collection\ResourceCollection;

class BookCollection extends ResourceCollection
{
}</code></pre>
<ul>
<li><code>src/Book/src/Entity/Book.php</code></li>
</ul>
<p>To keep things simple in this tutorial our book will have 3 properties: <code>name</code>, <code>author</code> and <code>release date</code>.</p>
<pre class="highlight"><code class="language-php">&lt;?php

declare(strict_types=1);

namespace Api\Book\Entity;

use Api\App\Entity\AbstractEntity;
use Api\App\Entity\TimestampsTrait;
use Api\Book\Repository\BookRepository;
use DateTimeImmutable;
use Doctrine\ORM\Mapping as ORM;

#[ORM\Entity(repositoryClass: BookRepository::class)]
#[ORM\Table("book")]
#[ORM\HasLifecycleCallbacks]
class Book extends AbstractEntity
{
    use TimestampsTrait;

    #[ORM\Column(name: "name", type: "string", length: 100)]
    protected string $name;

    #[ORM\Column(name: "author", type: "string", length: 100)]
    protected string $author;

    #[ORM\Column(name: "releaseDate", type: "datetime_immutable")]
    protected DateTimeImmutable $releaseDate;

    public function __construct(string $name, string $author, DateTimeImmutable $releaseDate)
    {
        parent::__construct();

        $this-&gt;setName($name);
        $this-&gt;setAuthor($author);
        $this-&gt;setReleaseDate($releaseDate);
    }

    public function getName(): string
    {
        return $this-&gt;name;
    }

    public function setName(string $name): self
    {
        $this-&gt;name = $name;

        return $this;
    }

    public function getAuthor(): string
    {
        return $this-&gt;author;
    }

    public function setAuthor(string $author): self
    {
        $this-&gt;author = $author;

        return $this;
    }

    public function getReleaseDate(): DateTimeImmutable
    {
        return $this-&gt;releaseDate;
    }

    public function setReleaseDate(DateTimeImmutable $releaseDate): self
    {
        $this-&gt;releaseDate = $releaseDate;

        return $this;
    }

    public function getArrayCopy(): array
    {
        return [
            'uuid' =&gt; $this-&gt;getUuid()-&gt;toString(),
            'name' =&gt; $this-&gt;getName(),
            'author' =&gt; $this-&gt;getAuthor(),
            'releaseDate' =&gt; $this-&gt;getReleaseDate(),
        ];
    }
}
</code></pre>
<ul>
<li><code>src/Book/src/Repository/BookRepository.php</code></li>
</ul>
<pre class="highlight"><code class="language-php">&lt;?php

declare(strict_types=1);

namespace Api\Book\Repository;

use Api\App\Helper\PaginationHelper;
use Api\Book\Collection\BookCollection;
use Api\Book\Entity\Book;
use Doctrine\ORM\EntityRepository;
use Dot\DependencyInjection\Attribute\Entity;

/**
 * @extends EntityRepository&lt;object&gt;
 */
 #[Entity(name: Book::class)]
class BookRepository extends EntityRepository
{
    public function saveBook(Book $book): Book
    {
        $this-&gt;getEntityManager()-&gt;persist($book);
        $this-&gt;getEntityManager()-&gt;flush();

        return $book;
    }

    public function getBooks(array $filters = []): BookCollection
    {
        $page = PaginationHelper::getOffsetAndLimit($filters);

        $qb = $this
            -&gt;getEntityManager()
            -&gt;createQueryBuilder()
            -&gt;select('book')
            -&gt;from(Book::class, 'book')
            -&gt;orderBy($filters['order'] ?? 'book.created', $filters['dir'] ?? 'desc')
            -&gt;setFirstResult($page['offset'])
            -&gt;setMaxResults($page['limit']);

        $qb-&gt;getQuery()-&gt;useQueryCache(true);

        return new BookCollection($qb, false);
    }
}</code></pre>
<ul>
<li><code>src/Book/src/Service/BookServiceInterface.php</code></li>
</ul>
<pre class="highlight"><code class="language-php">&lt;?php

declare(strict_types=1);

namespace Api\Book\Service;

use Api\Book\Repository\BookRepository;

interface BookServiceInterface
{
    public function getRepository(): BookRepository;
}</code></pre>
<ul>
<li><code>src/Book/src/Service/BookService.php</code></li>
</ul>
<pre class="highlight"><code class="language-php">&lt;?php

declare(strict_types=1);

namespace Api\Book\Service;

use Api\Book\Entity\Book;
use Api\Book\Repository\BookRepository;
use Dot\DependencyInjection\Attribute\Inject;
use DateTimeImmutable;

class BookService implements BookServiceInterface
{
    #[Inject(BookRepository::class)]
    public function __construct(protected BookRepository $bookRepository)
    {
    }

    public function getRepository(): BookRepository
    {
        return $this-&gt;bookRepository;
    }

    public function createBook(array $data): Book
    {
        $book = new Book(
            $data['name'],
            $data['author'],
            new DateTimeImmutable($data['releaseDate'])
        );

        return $this-&gt;bookRepository-&gt;saveBook($book);
    }

    public function getBooks(array $filters = [])
    {
        return $this-&gt;bookRepository-&gt;getBooks($filters);
    }
}</code></pre>
<p>When creating or updating a book, we will need some validators, so we will create input filters that will be used to validate the data received in the request</p>
<ul>
<li><code>src/Book/src/InputFilter/Input/AuthorInput.php</code></li>
</ul>
<pre class="highlight"><code class="language-php">&lt;?php

declare(strict_types=1);

namespace Api\Book\InputFilter\Input;

use Api\App\Message;
use Laminas\Filter\StringTrim;
use Laminas\Filter\StripTags;
use Laminas\InputFilter\Input;
use Laminas\Validator\NotEmpty;

class AuthorInput extends Input
{
    public function __construct(?string $name = null, bool $isRequired = true)
    {
        parent::__construct($name);

        $this-&gt;setRequired($isRequired);

        $this-&gt;getFilterChain()
            -&gt;attachByName(StringTrim::class)
            -&gt;attachByName(StripTags::class);

        $this-&gt;getValidatorChain()
            -&gt;attachByName(NotEmpty::class, [
                'message' =&gt; sprintf(Message::VALIDATOR_REQUIRED_FIELD_BY_NAME, 'author'),
            ], true);
    }
}</code></pre>
<ul>
<li><code>src/Book/src/InputFilter/Input/NameInput.php</code></li>
</ul>
<pre class="highlight"><code class="language-php">&lt;?php

declare(strict_types=1);

namespace Api\Book\InputFilter\Input;

use Api\App\Message;
use Laminas\Filter\StringTrim;
use Laminas\Filter\StripTags;
use Laminas\InputFilter\Input;
use Laminas\Validator\NotEmpty;

class NameInput extends Input
{
    public function __construct(?string $name = null, bool $isRequired = true)
    {
        parent::__construct($name);

        $this-&gt;setRequired($isRequired);

        $this-&gt;getFilterChain()
            -&gt;attachByName(StringTrim::class)
            -&gt;attachByName(StripTags::class);

        $this-&gt;getValidatorChain()
            -&gt;attachByName(NotEmpty::class, [
                'message' =&gt; sprintf(Message::VALIDATOR_REQUIRED_FIELD_BY_NAME, 'name'),
            ], true);
    }
}</code></pre>
<ul>
<li><code>src/Book/src/InputFilter/Input/ReleaseDateInput.php</code></li>
</ul>
<pre class="highlight"><code class="language-php">&lt;?php

declare(strict_types=1);

namespace Api\Book\InputFilter\Input;

use Api\App\Message;
use Laminas\Filter\StringTrim;
use Laminas\Filter\StripTags;
use Laminas\InputFilter\Input;
use Laminas\Validator\Date;
use Laminas\Validator\NotEmpty;

class ReleaseDateInput extends Input
{
    public function __construct(?string $name = null, bool $isRequired = true)
    {
        parent::__construct($name);

        $this-&gt;setRequired($isRequired);

        $this-&gt;getFilterChain()
            -&gt;attachByName(StringTrim::class)
            -&gt;attachByName(StripTags::class);

        $this-&gt;getValidatorChain()
            -&gt;attachByName(Date::class, [
                'message' =&gt; sprintf(Message::INVALID_VALUE, 'releaseDate'),
            ], true);
    }
}</code></pre>
<p>Now we add all the inputs together in a parent input filter.</p>
<ul>
<li><code>src/Book/src/InputFilter/BookInputFilter.php</code></li>
</ul>
<pre class="highlight"><code class="language-php">&lt;?php

declare(strict_types=1);

namespace Api\Book\InputFilter;

use Api\Book\InputFilter\Input\AuthorInput;
use Api\Book\InputFilter\Input\NameInput;
use Api\Book\InputFilter\Input\ReleaseDateInput;
use Laminas\InputFilter\InputFilter;

class BookInputFilter extends InputFilter
{
    public function __construct()
    {
        $this-&gt;add(new NameInput('name'));
        $this-&gt;add(new AuthorInput('author'));
        $this-&gt;add(new ReleaseDateInput('releaseDate'));
    }
}</code></pre>
<p>We split all the inputs just for the purpose of this tutorial and to demonstrate a clean <code>BookInputFiler</code> but you could have all the inputs created directly in the <code>BookInputFilter</code> like this:</p>
<pre class="highlight"><code class="language-php">$nameInput = new Input();
$nameInput-&gt;setRequired(true);

$nameInput-&gt;getFilterChain()
    -&gt;attachByName(StringTrim::class)
    -&gt;attachByName(StripTags::class);

$nameInput-&gt;getValidatorChain()
    -&gt;attachByName(NotEmpty::class, [
        'message' =&gt; sprintf(Message::VALIDATOR_REQUIRED_FIELD_BY_NAME, 'name'),
    ], true);

$this-&gt;add($nameInput);</code></pre>
<p>Now it's time to create the handlers for the book entity and book collection.</p>
<ul>
<li><code>src/Book/src/Handler/BookHandler.php</code></li>
</ul>
<pre class="highlight"><code class="language-php">&lt;?php

declare(strict_types=1);

namespace Api\Book\Handler;

use Api\App\Handler\AbstractHandler;
use Api\Book\InputFilter\BookInputFilter;
use Api\Book\Service\BookServiceInterface;
use Dot\DependencyInjection\Attribute\Inject;
use Fig\Http\Message\StatusCodeInterface;
use Mezzio\Hal\HalResponseFactory;
use Mezzio\Hal\ResourceGenerator;
use Psr\Http\Message\ResponseInterface;
use Psr\Http\Message\ServerRequestInterface;
use Psr\Http\Server\RequestHandlerInterface;

class BookHandler extends AbstractHandler implements RequestHandlerInterface
{
    #[Inject(
        BookServiceInterface::class,
        "config",
        HalResponseFactory::class,
        ResourceGenerator::class,
    )]
    public function __construct(
        protected BookServiceInterface $bookService,
        protected array $config,
        protected ?HalResponseFactory $responseFactory = null,
        protected ?ResourceGenerator $resourceGenerator = null,
    ) {
    }

    public function get(ServerRequestInterface $request): ResponseInterface
    {
        $book = $this-&gt;bookService-&gt;getRepository()-&gt;findOneBy(['uuid' =&gt; $request-&gt;getAttribute('uuid')]);

        if (! $book instanceof Book){
            return $this-&gt;notFoundResponse();
        }

        return $this-&gt;createResponse($request, $book);
    }

    public function getCollection(ServerRequestInterface $request): ResponseInterface
    {
        $books = $this-&gt;bookService-&gt;getRepository()-&gt;getBooks($request-&gt;getQueryParams());

        return $this-&gt;createResponse($request, $books);
    }

    public function post(ServerRequestInterface $request): ResponseInterface
    {
        $inputFilter = (new BookInputFilter())-&gt;setData($request-&gt;getParsedBody());
        if (! $inputFilter-&gt;isValid()) {
            return $this-&gt;errorResponse($inputFilter-&gt;getMessages(), StatusCodeInterface::STATUS_UNPROCESSABLE_ENTITY);
        }

        $book = $this-&gt;bookService-&gt;createBook($inputFilter-&gt;getValues());

        return $this-&gt;createResponse($request, $book);
    }
}</code></pre>
<ul>
<li><code>src/Book/src/Handler/BookCollectionHandler.php</code></li>
</ul>
<pre class="highlight"><code class="language-php">&lt;?php

declare(strict_types=1);

namespace Api\Book\Handler;

use Api\App\Exception\BadRequestException;
use Api\App\Handler\AbstractHandler;
use Api\Book\Service\BookServiceInterface;
use Dot\DependencyInjection\Attribute\Inject;
use Mezzio\Hal\HalResponseFactory;
use Mezzio\Hal\ResourceGenerator;
use Psr\Http\Message\ResponseInterface;
use Psr\Http\Message\ServerRequestInterface;

class BookCollectionHandler extends AbstractHandler
{
    #[Inject(
        BookServiceInterface::class,
        "config",
        HalResponseFactory::class,
        ResourceGenerator::class,
    )]
    public function __construct(
        protected BookServiceInterface $bookService,
        protected array $config,
        protected ?HalResponseFactory $responseFactory = null,
        protected ?ResourceGenerator $resourceGenerator = null,
    ) {
    }

    /**
     * @throws BadRequestException
     */
    public function get(ServerRequestInterface $request): ResponseInterface
    {
        return $this-&gt;createResponse($request, $this-&gt;bookService-&gt;getBooks(
            $request-&gt;getQueryParams()
        ));
    }
}</code></pre>
<p>After we have the handler, we need to register some routes in the <code>RoutesDelegator</code>, the same we created when  we registered the module.</p>
<ul>
<li><code>src/Book/src/RoutesDelegator.php</code></li>
</ul>
<pre class="highlight"><code class="language-php">&lt;?php

declare(strict_types=1);

namespace Api\Book;

use Api\Book\Collection\BookCollection;
use Api\Book\Handler\BookCollectionHandler;
use Api\Book\Handler\BookHandler;
use Mezzio\Application;
use Psr\Container\ContainerInterface;

class RoutesDelegator
{
    public function __invoke(ContainerInterface $container, string $serviceName, callable $callback): Application
    {
        /** @var Application $app */
        $app = $callback();

        $uuid = \Api\App\RoutesDelegator::REGEXP_UUID;

        $app-&gt;get(
            '/books',
            BookCollectionHandler::class,
            'books.list'
        );

        $app-&gt;get(
            '/book/' . $uuid,
            BookCollection::class,
            'book.show'
        );

        $app-&gt;post(
            '/book',
            BookHandler::class,
            'book.create'
        );

        return $app;
    }
}</code></pre>
<p>We need to configure access to the newly created endpoints, add <code>books.list</code>, <code>book.show</code> and <code>book.create</code> to the authorization rbac array, under the <code>UserRole::ROLE_GUEST</code> key.</p>
<blockquote>
<p>Make sure you read and understand the rbac documentation.</p>
</blockquote>
<p>It's time to update the <code>ConfigProvider</code> with all the necessary configuration needed, so the above files to work properly like dependency injection, aliases, doctrine mapping and so on.</p>
<ul>
<li><code>src/Book/src/ConfigProvider.php</code></li>
</ul>
<pre class="highlight"><code class="language-php">&lt;?php

declare(strict_types=1);

namespace Api\Book;

use Api\Book\Collection\BookCollection;
use Api\Book\Entity\Book;
use Api\Book\Handler\BookHandler;
use Api\Book\Repository\BookRepository;
use Api\Book\Service\BookService;
use Api\Book\Service\BookServiceInterface;
use Doctrine\ORM\Mapping\Driver\AttributeDriver;
use Dot\DependencyInjection\Factory\AttributedRepositoryFactory;
use Dot\DependencyInjection\Factory\AttributedServiceFactory;
use Mezzio\Application;
use Mezzio\Hal\Metadata\MetadataMap;
use Api\App\ConfigProvider as AppConfigProvider;

class ConfigProvider
{
    public function __invoke(): array
    {
        return [
            'dependencies'     =&gt; $this-&gt;getDependencies(),
            'doctrine'     =&gt; $this-&gt;getDoctrineConfig(),
            MetadataMap::class =&gt; $this-&gt;getHalConfig(),
        ];
    }

    private function getDependencies(): array
    {
        return [
            'delegators' =&gt; [
                Application::class =&gt; [
                    RoutesDelegator::class
                ]
            ],
            'factories' =&gt; [
                BookHandler::class    =&gt; AttributedServiceFactory::class,
                BookService::class    =&gt; AttributedServiceFactory::class,
                BookRepository::class =&gt; AttributedRepositoryFactory::class,
                BookCollectionHandler::class =&gt; AttributedServiceFactory::class,
            ],
            'aliases'   =&gt; [
                BookServiceInterface::class     =&gt; BookService::class,
            ],
        ];
    }

    private function getDoctrineConfig(): array
    {
        return [
            'driver' =&gt; [
                'orm_default'   =&gt; [
                    'drivers' =&gt; [
                        'Api\Book\Entity' =&gt; 'BookEntities'
                    ],
                ],
                'BookEntities'  =&gt; [
                    'class' =&gt; AttributeDriver::class,
                    'cache' =&gt; 'array',
                    'paths' =&gt; __DIR__ . '/Entity',
                ],
            ],
        ];
    }

    private function getHalConfig(): array
    {
        return [
            AppConfigProvider::getCollection(BookCollection::class, 'books.list', 'books'),
            AppConfigProvider::getResource(Book::class, 'book.show')
        ];
    }

}</code></pre>
<h2 id="migrations">Migrations</h2>
<p>We created the <code>Book</code> entity, but we didn't create the associated table for it.</p>
<blockquote>
<p>You can check the mapping files by running:</p>
</blockquote>
<pre class="highlight"><code class="language-shel">php bin/doctrine orm:validate-schema</code></pre>
<p>Doctrine can handle the table creation, run the following command:</p>
<pre class="highlight"><code class="language-shell">vendor/bin/doctrine-migrations diff --filter-expression='/^(?!oauth_)/'</code></pre>
<p>This will check for differences between your entities and database structure and create migration files if necessary, in <code>data/doctrine/migrations</code>.</p>
<p>To execute the migrations run:</p>
<pre class="highlight"><code class="language-shell">vendor/bin/doctrine-migrations migrate</code></pre>
<h2 id="checking-endpoints">Checking endpoints</h2>
<p>If we did everything as planned we can call the <code>http://0.0.0.0:8080/book</code> endpoint and create a new book:</p>
<pre class="highlight"><code class="language-shell">curl -X POST http://0.0.0.0:8080/book
  -H "Content-Type: application/json"
  -d '{"name": "test", "author": "author name", "releaseDate": "2023-03-03"}'</code></pre>
<p>To list the books use:</p>
<pre class="highlight"><code class="language-shell">curl http://0.0.0.0:8080/books</code></pre>
<p>To retrieve a book use:</p>
<pre class="highlight"><code class="language-shell">curl http://0.0.0.0:8080/book/{uuid}</code></pre>




    <nav>
    <ul class="list-unstyled page-nav row w-100 mt-5 mb-3 pt-5 pb-3">
        
        <li class="col text-nowrap text-md-start">
            
                <a rel="prev" class="page-nav__link page-nav__link--prev" href="../cors/">
                    <i class="bi bi-chevron-left"></i>
                    Setting up CORS
                </a>
            
        </li>

        
        <li class="col text-nowrap text-md-end pe-0">
            
                <a rel="next" class="page-nav__link page-nav__link--next" href="../token-authentication/">
                    Token authentication
                    <i class="bi bi-chevron-right"></i>
                </a>
            
        </li>
    </ul>
</nav>



                    
                </div>
            </div>
        </div>

        
        <footer class="footer">
    <div class="container">
        <hr class="mb-5" />

        <div class="row">
            <div class="col-md-9">
                <div class="row">
                    <div class="col-lg-4 col-md-6 dk_widget">
                        <p class="ms-0">API</p>

                        <a href="https://docs.dotkernel.org/api-documentation/">
                            <i class="bi bi-arrow-return-right"></i>
                            Dotkernel web starter project suitable for building RESTful APIs
                        </a>
                    </div>

                    <div class="col-lg-4 col-md-6 dk_widget">
                        <p class="ms-0">Admin</p>

                        <a href="https://docs.dotkernel.org/admin-documentation/">
                            <i class="bi bi-arrow-return-right"></i>
                            Dotkernel web starter project suitable for admin applications
                        </a>
                    </div>

                    <div class="col-lg-4 col-md-6 dk_widget">
                        <p class="ms-0">Frontend</p>

                        <a href="https://docs.dotkernel.org/frontend-documentation/">
                            <i class="bi bi-arrow-return-right"></i>
                            Dotkernel web starter project suitable for frontend applications
                        </a>
                    </div>

                    <div class="col-lg-4 col-md-6 dk_widget">
                        <p class="ms-0">Light</p>

                        <a href="https://docs.dotkernel.org/light-documentation/">
                            <i class="bi bi-arrow-return-right"></i>
                            Dotkernel web starter project suitable for generating a simple website
                        </a>
                    </div>

                    <div class="col-lg-4 col-md-6 dk_widget">
                        <p class="ms-0">Dotkernel Packages</p>

                        <a href="https://docs.dotkernel.org/packages/">
                            <i class="bi bi-arrow-return-right"></i>
                            Dotkernel packages offering a wide range of tools
                        </a>
                    </div>

                    <div class="col-lg-4 col-md-6 dk_widget">
                        <p class="ms-0">Development environment</p>

                        <a href="https://docs.dotkernel.org/development/">
                            <i class="bi bi-arrow-return-right"></i>
                            Install PHP, Apache, MariaDB, Composer, PhpMyAdmin, Node.js and Git on WSL2
                        </a>
                    </div>
                </div>
            </div>

            <div class="col-md-3 pt-3 mt-1">
                <ul class="support__list row">
                    <li class="support__list-item col-lg-6 mb-md-3">
                        <a href="https://github.com/dotkernel" class="support__link" title="GitHub" target="_blank">
                            <i class="bi bi-github"></i> GitHub
                        </a>
                    </li>
                    <li class="support__list-item col-lg-6 mb-md-3">
                        <a href="https://dotkernel.slack.com" class="support__link" title="Chat" target="_blank">
                            <i class="bi bi-slack"></i> Slack
                        </a>
                    </li>
                    <li class="support__list-item col-lg-6 mb-md-3">
                        <a href="https://twitter.com/dotkernel" class="support__link" title="X (Twitter)" target="_blank">
                            <i class="bi bi-twitter-x"></i> Twitter
                        </a>
                    </li>
                    <li class="support__list-item col-lg-6 mb-md-3">
                        <a href="https://www.dotkernel.com/blog/" class="support__link" title="Blog" target="_blank">
                            <i class="bi bi-file-post"></i> Blog
                        </a>
                    </li>
                    <li class="support__list-item col-lg-6 mb-md-3">
                        <a href="https://www.dotkernel.com/feed/" class="support__link" title="Blog feed" target="_blank">
                            <i class="bi bi-rss-fill"></i> Feed
                        </a>
                    </li>
                </ul>
            </div>
        </div>

        <hr class="mt-5" />

        <div class="footer_copy">
            &#169; Copyright Dotkernel 2024. All rights reserved.
        </div>
    </div>
</footer>

        <script>
            let base_url = '../../..',
                project  = "api",
                siteName = 'api';

                document.addEventListener("DOMContentLoaded", function() {
                    document.querySelectorAll('.subnavigation__link').forEach(function(link) {
                        if (link.getAttribute('href') === './') {
                            link.parentNode.parentNode.classList.add('show');
                        }
                    });
                });
        </script>
<!--        -->
<!--        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Search</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search in api" id="mkdocs-search-query">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
        </div>
    </div>
</div>-->
    </body>
</html>
