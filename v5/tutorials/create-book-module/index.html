<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="description" content="DotKernel API">
        
        

        
        
            
        
        <meta name="docsearch:version" content="5.0.0,latest">
        <meta name="docsearch:language" content="en">
        <meta name="docsearch:component" content="api">

        
        <link rel="canonical" href="https://docs.dotkernel.org/api-documentation/v5/tutorials/create-book-module/">
        
        <link rel="shortcut icon" href="https://docs.dotkernel.org/img/dk_docs_favicon_white.svg">

        <title>Creating a book module - api - DotKernel Documentation</title>

        <link rel="stylesheet" href="https://docs.dotkernel.org/css/bootstrap.css">
        <link rel="stylesheet" href="https://docs.dotkernel.org/css/bootstrap-icons.min.css">
        <link rel="stylesheet" href="https://docs.dotkernel.org/css/docs.css">
        <script src="https://docs.dotkernel.org//js/bootstrap.js" defer></script>
        <script src="https://docs.dotkernel.org//js/docs.js" defer></script>
        <script src="https://docs.dotkernel.org//js/scripts.js" defer></script>
    </head>
    <body data-bs-spy="scroll" data-bs-target=".toc" data-bs-offset="100">

        
        <nav class="navbar navbar-expand-lg bg-body-tertiary bg-light dk-nav py-3" data-bs-theme="light">
    <div class="container justify-content-between">
        <div class="dk-nav-icon d-flex align-items-center">
            <a class="navbar-brand" href="https://docs.dotkernel.org/">
                <img alt="DotKernel Logo" class="d-inline-block align-text-top" height="50"
                     src="https://docs.dotkernel.org//img/dk_logomark_white.svg" width="45"/>
            </a>

            <div class="dk-nav-icon-items">
                <span style="font-size: 12px; line-height: 13px">DotKernel Documentation</span>

                <div class="dropdown" data-bs-theme="light">
                    <span class="fw-bold dropdown-toggle dk-pkg-name" data-bs-toggle="dropdown" aria-expanded="false">API</span>
                    <ul class="dropdown-menu">
                        
                        <li class="dropdown-item bg-light">
                            <a href="https://docs.dotkernel.org/api-documentation/" class="nav-link d-flex gap-4 align-items-center">
                                <img alt="DotKernel Logo" class="d-inline-block align-text-top" height="50" src="https://docs.dotkernel.org/img/dk_logomark.svg" width="45" />
                                <div>
                                    <span class="fw-bold d-block">API</span>
                                    <span>DotKernel API</span>
                                </div>
                            </a>
                        </li>
                        
                        <li class="dropdown-item ">
                            <a href="https://docs.dotkernel.org/admin/" class="nav-link d-flex gap-4 align-items-center">
                                <img alt="DotKernel Logo" class="d-inline-block align-text-top" height="50" src="https://docs.dotkernel.org/img/dk_logomark.svg" width="45" />
                                <div>
                                    <span class="fw-bold d-block">Admin</span>
                                    <span>DotKernel Admin application</span>
                                </div>
                            </a>
                        </li>
                        
                        <li class="dropdown-item ">
                            <a href="https://docs.dotkernel.org/frontend/" class="nav-link d-flex gap-4 align-items-center">
                                <img alt="DotKernel Logo" class="d-inline-block align-text-top" height="50" src="https://docs.dotkernel.org/img/dk_logomark.svg" width="45" />
                                <div>
                                    <span class="fw-bold d-block">Frontend</span>
                                    <span>DotKernel Frontend application</span>
                                </div>
                            </a>
                        </li>
                        
                        <li class="dropdown-item ">
                            <a href="https://docs.dotkernel.org/packages/" class="nav-link d-flex gap-4 align-items-center">
                                <img alt="DotKernel Logo" class="d-inline-block align-text-top" height="50" src="https://docs.dotkernel.org/img/dk_logomark.svg" width="45" />
                                <div>
                                    <span class="fw-bold d-block">Packages</span>
                                    <span>DotKernel packages</span>
                                </div>
                            </a>
                        </li>
                        
                    </ul>
                </div>
            </div>
        </div>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarText" aria-controls="navbarText" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarText">
            <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
<!--                <li class="nav-item">-->
<!--                    <a href="#" class="nav-link fw-bold text-white" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal" title="Open search">-->
<!--                        <i class="bi bi-search"></i> Search-->
<!--                    </a>-->
<!--                </li>-->
                <li class="nav-item">
                    <a class="nav-link fw-bold text-white" href="https://github.com/dotkernel/api" title="Go to api repository" target="_blank">
                        <i class="bi bi-github"></i>
                        GitHub
                    </a>
                </li>
                <li class="nav-item">
                    
<div class="version-selector">
    <div class="btn-group">
        <button type="button" class="btn dropdown-toggle bg-light" data-toggle="dropdown" data-display="static" aria-haspopup="true" aria-expanded="false" id="version-selector-dropdown">
            
                v5
            
        </button>
        <div class="dropdown-menu dropdown-menu-right dropdown-menu-lg-left" aria-labelledby="version-selector-dropdown">
            
                
                    <a href="../../introduction/introduction/" class="dropdown-item active">
                        
                            v5 (latest)
                        
                    </a>
                
            
                
                    <a href="../../../v4/introduction/introduction/" class="dropdown-item">
                        
                            v4
                        
                    </a>
                
            
        </div>
    </div>
</div>

                </li>
            </ul>
        </div>
    </div>
</nav>

        
        <div class="container">
    <nav aria-label="breadcrumb" class="nav_breadcrumb">
        <ol class="breadcrumb">
            
                <li class="breadcrumb-item"><a href="https://docs.dotkernel.org/">Overview</a></li>
                

                
                    <li class="breadcrumb-item"><a href="../../..">api</a></li>

                    
                        
                            
                            
                        
                    
                        
                            
                            
                                <li class="breadcrumb-item">Tutorials</li>
                            
                        
                    

                    <li class="breadcrumb-item active" aria-current="page">Creating a book module</li>
                
            
        </ol>
    </nav>
</div>

        
        <div class="container">
            <div class="row">
                <div class="col-lg-3 right_sidebar">
                    
                    
    <div class="subnavigation hidden-print">
<!--        <h4 class="subnavigation__title">-->
<!--            <a href="../../..">api</a>-->
<!--        </h4>-->

        <h5 class="subnavigation__title">Table of Contents</h5>

        <ul class="subnavigation__list">
            

                
                
                    
                        
<li class="subnavigation__list-item ">
    <a href="../../introduction/introduction/" class="subnavigation__link">Introduction</a>
</li>

                    
                        



















<li class="subnavigation__list-item">
    <a data-bs-toggle="collapse" href="#overview" role="button" aria-expanded="false" aria-controls="overview">
        <span class="subnavigation__headline">Overview</span>
    </a>
    <ul class="subnavigation__list collapse" id="overview">
        
        
<li class="subnavigation__list-item ">
    <a href="../../introduction/server-requirements/" class="subnavigation__link">Server Requirements</a>
</li>

        
        
<li class="subnavigation__list-item ">
    <a href="../../introduction/file-structure/" class="subnavigation__link">File Structure</a>
</li>

        
        
<li class="subnavigation__list-item ">
    <a href="../../introduction/packages/" class="subnavigation__link">Packages</a>
</li>

        
    </ul>
</li>

                    
                        



























<li class="subnavigation__list-item">
    <a data-bs-toggle="collapse" href="#installation" role="button" aria-expanded="false" aria-controls="installation">
        <span class="subnavigation__headline">Installation</span>
    </a>
    <ul class="subnavigation__list collapse" id="installation">
        
        
<li class="subnavigation__list-item ">
    <a href="../../installation/getting-started/" class="subnavigation__link">Getting Started</a>
</li>

        
        
<li class="subnavigation__list-item ">
    <a href="../../installation/composer/" class="subnavigation__link">Composer</a>
</li>

        
        
<li class="subnavigation__list-item ">
    <a href="../../installation/configuration-files/" class="subnavigation__link">Configuration Files</a>
</li>

        
        
<li class="subnavigation__list-item ">
    <a href="../../installation/doctrine-orm/" class="subnavigation__link">Doctrine ORM</a>
</li>

        
        
<li class="subnavigation__list-item ">
    <a href="../../installation/test-the-installation/" class="subnavigation__link">Test the Installation</a>
</li>

        
        
<li class="subnavigation__list-item ">
    <a href="../../installation/faq/" class="subnavigation__link">FAQ</a>
</li>

        
    </ul>
</li>

                    
                        











<li class="subnavigation__list-item">
    <a data-bs-toggle="collapse" href="#flow" role="button" aria-expanded="false" aria-controls="flow">
        <span class="subnavigation__headline">Flow</span>
    </a>
    <ul class="subnavigation__list collapse" id="flow">
        
        
<li class="subnavigation__list-item ">
    <a href="../../flow/middleware-flow/" class="subnavigation__link">Middleware Flow</a>
</li>

        
        
<li class="subnavigation__list-item ">
    <a href="../../flow/default-library-flow/" class="subnavigation__link">Default Library Flow</a>
</li>

        
        
<li class="subnavigation__list-item ">
    <a href="../../flow/library-flow-for-email/" class="subnavigation__link">Library Flow for Email</a>
</li>

        
    </ul>
</li>

                    
                        





























<li class="subnavigation__list-item">
    <a data-bs-toggle="collapse" href="#core-features" role="button" aria-expanded="false" aria-controls="core-features">
        <span class="subnavigation__headline">Core Features</span>
    </a>
    <ul class="subnavigation__list collapse" id="core-features">
        
        
<li class="subnavigation__list-item ">
    <a href="../../core-features/authentication/" class="subnavigation__link">Authentication</a>
</li>

        
        
<li class="subnavigation__list-item ">
    <a href="../../core-features/authorization/" class="subnavigation__link">Authorization</a>
</li>

        
        
<li class="subnavigation__list-item ">
    <a href="../../core-features/content-validation/" class="subnavigation__link">Content Validation</a>
</li>

        
        
<li class="subnavigation__list-item ">
    <a href="../../core-features/exceptions/" class="subnavigation__link">Exceptions</a>
</li>

        
        
<li class="subnavigation__list-item ">
    <a href="../../core-features/cors/" class="subnavigation__link">CORS</a>
</li>

        
    </ul>
</li>

                    
                        



















<li class="subnavigation__list-item">
    <a data-bs-toggle="collapse" href="#commands" role="button" aria-expanded="false" aria-controls="commands">
        <span class="subnavigation__headline">Commands</span>
    </a>
    <ul class="subnavigation__list collapse" id="commands">
        
        
<li class="subnavigation__list-item ">
    <a href="../../commands/create-admin-account/" class="subnavigation__link">Create admin account</a>
</li>

        
        
<li class="subnavigation__list-item ">
    <a href="../../commands/generate-database-migrations/" class="subnavigation__link">Generate database migrations</a>
</li>

        
        
<li class="subnavigation__list-item ">
    <a href="../../commands/display-available-endpoints/" class="subnavigation__link">Display available endpoints</a>
</li>

        
        
<li class="subnavigation__list-item ">
    <a href="../../commands/generate-tokens/" class="subnavigation__link">Generate tokens</a>
</li>

        
    </ul>
</li>

                    
                        





















<li class="subnavigation__list-item">
    <a data-bs-toggle="collapse" href="#tutorials" role="button" aria-expanded="false" aria-controls="tutorials">
        <span class="subnavigation__headline">Tutorials</span>
    </a>
    <ul class="subnavigation__list collapse" id="tutorials">
        
        
<li class="subnavigation__list-item subnavigation__list-item--active">
    <a href="./" class="subnavigation__link">Creating a book module</a>
</li>

        
        
<li class="subnavigation__list-item ">
    <a href="../token-authentication/" class="subnavigation__link">Token authentication</a>
</li>

        
    </ul>
</li>

                    
                        





















































<li class="subnavigation__list-item">
    <a data-bs-toggle="collapse" href="#transition-from-api-tools" role="button" aria-expanded="false" aria-controls="transition-from-api-tools">
        <span class="subnavigation__headline">Transition from API Tools</span>
    </a>
    <ul class="subnavigation__list collapse" id="transition-from-api-tools">
        
        
<li class="subnavigation__list-item ">
    <a href="../../transition-from-api-tools/api-tools-vs-dotkernel-api/" class="subnavigation__link">Laminas API Tools vs DotKernel API</a>
</li>

        
        
<li class="subnavigation__list-item ">
    <a href="../../transition-from-api-tools/transition-approach/" class="subnavigation__link">Transition Approach</a>
</li>

        
        
<li class="subnavigation__list-item ">
    <a href="../../transition-from-api-tools/discovery-phase/" class="subnavigation__link">Discovery Phase</a>
</li>

        
    </ul>
</li>

                    
                
            

                
                

                    
                    
                
            
        </ul>
    </div>

                    

                    
                    
                    
    

    
    
        <div class="toc">
            <h6 class="toc__headline">On this page</h6>
            <ul class="toc__list">
            
                <li class="toc__entry">
                    <a href="#file-structure" class="toc__link nav-link">File structure</a>
                </li>
            
                <li class="toc__entry">
                    <a href="#file-creation-and-contents" class="toc__link nav-link">File creation and contents</a>
                </li>
            
                <li class="toc__entry">
                    <a href="#configuring-and-registering-the-new-module" class="toc__link nav-link">Configuring and registering the new module</a>
                </li>
            
                <li class="toc__entry">
                    <a href="#migrations" class="toc__link nav-link">Migrations</a>
                </li>
            
                <li class="toc__entry">
                    <a href="#checking-endpoints" class="toc__link nav-link">Checking endpoints</a>
                </li>
            
            </ul>
        </div>
    

                    
                </div>
                <div class="col-lg-9 main_docs">
                    
                    




    
    
<!--        <h2 class="chapter__headline text-black-50">Tutorials</h2>-->
    

    <h1 id="implementing-a-book-module-in-dotkernel-api">Implementing a book module in DotKernel API</h1>
<h2 id="file-structure">File structure</h2>
<p>The below file structure is just an example, you can have multiple components such as event listeners, wrappers, etc.</p>
<pre class="highlight"><code class="language-markdown">.
└── src/
    └── Book/
        └── src/
            ├── Collection/
            │   └── BookCollection.php
            ├── Entity/
            │   └── Book.php
            ├── Handler/
            │   └── BookHandler.php
            ├── InputFilter/
            │   ├── Input/
            │   │   ├── AuthorInput.php
            │   │   ├── NameInput.php
            │   │   └── ReleaseDateInput.php
            │   └── BookInputFilter.php
            ├── Repository/
            │   └── BookRepository.php
            ├── Service/
            │   ├── BookService.php
            │   └── BookServiceInterface.php
            ├── ConfigProvider.php
            └── RoutesDelegator.php</code></pre>
<ul>
<li><code>src/Book/src/Collection/BookCollection.php</code> - a collection refers to a container for a group of related objects, typically used to manage sets of related entities fetched from a database</li>
<li><code>src/Book/src/Entity/Book.php</code> - an entity refers to a PHP class that represents a persistent object or data structure</li>
<li><code>src/Book/src/Handler/BookHandler.php</code> - handlers are middleware that can handle requests based on an action</li>
<li><code>src/Book/src/Repository/BookRepository.php</code> - a repository is a class responsible for querying and retrieving entities from the database</li>
<li><code>src/Book/src/Service/BookService.php</code> - is a class or component responsible for performing a specific task or providing functionality to other parts of the application</li>
<li><code>src/Book/src/ConfigProvider.php</code> -  is a class that provides configuration for various aspects of the framework or application</li>
<li><code>src/Book/src/RoutesDelegator.php</code> - a routes delegator is a delegator factory responsible for configuring routing middleware based on routing configuration provided by the application</li>
<li><code>src/Book/src/InputFilter/BookInputFilter.php</code> - input filters and validators</li>
<li><code>src/Book/src/InputFilter/Input/*</code> - input filters and validator configurations</li>
</ul>
<h2 id="file-creation-and-contents">File creation and contents</h2>
<ul>
<li><code>src/Book/src/Collection/BookCollection.php</code></li>
</ul>
<pre class="highlight"><code class="language-php">&lt;?php

declare(strict_types=1);

namespace Api\Book\Collection;

use Api\App\Collection\ResourceCollection;

class BookCollection extends ResourceCollection
{
}</code></pre>
<ul>
<li><code>src/Book/src/Entity/Book.php</code></li>
</ul>
<p>To keep things simple in this tutorial our book will have 3 properties: <code>name</code>, <code>author</code> and <code>release date</code>.</p>
<pre class="highlight"><code class="language-php">&lt;?php

declare(strict_types=1);

namespace Api\Book\Entity;

use Api\App\Entity\AbstractEntity;
use Api\Book\Repository\BookRepository;
use DateTimeImmutable;
use Doctrine\ORM\Mapping as ORM;

#[ORM\Entity(repositoryClass: BookRepository::class)]
#[ORM\Table("book")]
class Book extends AbstractEntity
{
    #[ORM\Column(name: "name", type: "string", length: 100)]
    protected string $name;

    #[ORM\Column(name: "author", type: "string", length: 100)]
    protected string $author;

    #[ORM\Column(name: "releaseDate", type: "datetime_immutable")]
    protected DateTimeImmutable $releaseDate;

    public function __construct(string $name, string $author, DateTimeImmutable $releaseDate)
    {
        parent::__construct();

        $this-&gt;setName($name);
        $this-&gt;setAuthor($author);
        $this-&gt;setReleaseDate($releaseDate);
    }

    public function getName(): string
    {
        return $this-&gt;name;
    }

    public function setName(string $name): self
    {
        $this-&gt;name = $name;

        return $this;
    }

    public function getAuthor(): string
    {
        return $this-&gt;author;
    }

    public function setAuthor(string $author): self
    {
        $this-&gt;author = $author;

        return $this;
    }

    public function getReleaseDate(): DateTimeImmutable
    {
        return $this-&gt;releaseDate;
    }

    public function setReleaseDate(DateTimeImmutable $releaseDate): self
    {
        $this-&gt;releaseDate = $releaseDate;

        return $this;
    }

    public function getArrayCopy(): array
    {
        return [
            'uuid' =&gt; $this-&gt;getUuid()-&gt;toString(),
            'name' =&gt; $this-&gt;getName(),
            'author' =&gt; $this-&gt;getAuthor(),
            'releaseDate' =&gt; $this-&gt;getReleaseDate(),
        ];
    }
}</code></pre>
<ul>
<li><code>src/Book/src/Repository/BookRepository.php</code></li>
</ul>
<pre class="highlight"><code class="language-php">&lt;?php

declare(strict_types=1);

namespace Api\Book\Repository;

use Api\App\Helper\PaginationHelper;
use Api\Book\Collection\BookCollection;
use Api\Book\Entity\Book;
use Doctrine\ORM\EntityRepository;
use Dot\AnnotatedServices\Annotation\Entity;

/**
 * @Entity(name="Api\Book\Entity\Book")
 * @extends EntityRepository&lt;object&gt;
 */
class BookRepository extends EntityRepository
{
    public function saveBook(Book $book): Book
    {
        $this-&gt;getEntityManager()-&gt;persist($book);
        $this-&gt;getEntityManager()-&gt;flush();

        return $book;
    }

    public function getBooks(array $filters = []): BookCollection
    {
        $page = PaginationHelper::getOffsetAndLimit($filters);

        $qb = $this
            -&gt;getEntityManager()
            -&gt;createQueryBuilder()
            -&gt;select('book')
            -&gt;from(Book::class, 'book')
            -&gt;orderBy($filters['order'] ?? 'book.created', $filters['dir'] ?? 'desc')
            -&gt;setFirstResult($page['offset'])
            -&gt;setMaxResults($page['limit']);

        $qb-&gt;getQuery()-&gt;useQueryCache(true);

        return new BookCollection($qb, false);
    }
}</code></pre>
<ul>
<li><code>src/Book/src/Service/BookService.php</code></li>
</ul>
<pre class="highlight"><code class="language-php">&lt;?php

declare(strict_types=1);

namespace Api\Book\Service;

use Api\Book\Entity\Book;
use Api\Book\Repository\BookRepository;
use Dot\AnnotatedServices\Annotation\Inject;
use DateTimeImmutable;

class BookService implements BookServiceInterface
{
    /**
     * @Inject({
     *     BookRepository::class,
     * })
     */
    public function __construct(protected BookRepository $bookRepository)
    {
    }

    public function createBook(array $data): Book
    {
        $book = new Book(
            $data['name'],
            $data['author'],
            new DateTimeImmutable($data['releaseDate'])
        );

        return $this-&gt;bookRepository-&gt;saveBook($book);
    }

    public function getBooks(array $filters = [])
    {
        return $this-&gt;bookRepository-&gt;getBooks($filters);
    }
}</code></pre>
<ul>
<li><code>src/Book/src/Service/BookServiceInterface.php</code></li>
</ul>
<pre class="highlight"><code class="language-php">&lt;?php

declare(strict_types=1);

namespace Api\Book\Service;

interface BookServiceInterface
{
}</code></pre>
<ul>
<li><code>src/Book/src/ConfigProvider.php</code></li>
</ul>
<pre class="highlight"><code class="language-php">&lt;?php

declare(strict_types=1);

namespace Api\Book;

use Api\Book\Collection\BookCollection;
use Api\Book\Entity\Book;
use Api\Book\Handler\BookHandler;
use Api\Book\Repository\BookRepository;
use Api\Book\Service\BookService;
use Api\Book\Service\BookServiceInterface;
use Dot\AnnotatedServices\Factory\AnnotatedRepositoryFactory;
use Dot\AnnotatedServices\Factory\AnnotatedServiceFactory;
use Mezzio\Hal\Metadata\MetadataMap;
use Api\App\ConfigProvider as AppConfigProvider;

class ConfigProvider
{
    public function __invoke(): array
    {
        return [
            'dependencies'     =&gt; $this-&gt;getDependencies(),
            MetadataMap::class =&gt; $this-&gt;getHalConfig(),
        ];
    }

    public function getDependencies(): array
    {
        return [
            'factories' =&gt; [
                BookHandler::class        =&gt; AnnotatedServiceFactory::class,
                BookService::class =&gt; AnnotatedServiceFactory::class,
                BookRepository::class =&gt; AnnotatedRepositoryFactory::class,
            ],
            'aliases'   =&gt; [
                BookServiceInterface::class     =&gt; BookService::class,
            ],
        ];
    }

    public function getHalConfig(): array
    {
        return [
            AppConfigProvider::getCollection(BookCollection::class, 'books.list', 'books'),
            AppConfigProvider::getResource(Book::class, 'book.create'),
        ];
    }
}</code></pre>
<ul>
<li><code>src/Book/src/RoutesDelegator.php</code></li>
</ul>
<pre class="highlight"><code class="language-php">&lt;?php

namespace Api\Book;

use Api\Book\Handler\BookHandler;
use Mezzio\Application;
use Psr\Container\ContainerInterface;

class RoutesDelegator
{
    public function __invoke(ContainerInterface $container, string $serviceName, callable $callback): Application
    {
        /** @var Application $app */
        $app = $callback();

        $app-&gt;get(
            '/books',
            BookHandler::class,
            'books.list'
        );

        $app-&gt;post(
            '/book',
            BookHandler::class,
            'book.create'
        );

        return $app;
    }
}</code></pre>
<ul>
<li><code>src/Book/src/InputFilter/BookInputFilter.php</code></li>
</ul>
<pre class="highlight"><code class="language-php">&lt;?php

declare(strict_types=1);

namespace Api\Book\InputFilter;

use Api\Book\InputFilter\Input\AuthorInput;
use Api\Book\InputFilter\Input\NameInput;
use Api\Book\InputFilter\Input\ReleaseDateInput;
use Laminas\InputFilter\InputFilter;

class BookInputFilter extends InputFilter
{
    public function __construct()
    {
        $this-&gt;add(new NameInput('name'));
        $this-&gt;add(new AuthorInput('author'));
        $this-&gt;add(new ReleaseDateInput('releaseDate'));
    }
}</code></pre>
<ul>
<li><code>src/Book/src/InputFilter/Input/AuthorInput.php</code></li>
</ul>
<pre class="highlight"><code class="language-php">&lt;?php

declare(strict_types=1);

namespace Api\Book\InputFilter\Input;

use Api\App\Message;
use Laminas\Filter\StringTrim;
use Laminas\Filter\StripTags;
use Laminas\InputFilter\Input;
use Laminas\Validator\NotEmpty;

class AuthorInput extends Input
{
    public function __construct(?string $name = null, bool $isRequired = true)
    {
        parent::__construct($name);

        $this-&gt;setRequired($isRequired);

        $this-&gt;getFilterChain()
            -&gt;attachByName(StringTrim::class)
            -&gt;attachByName(StripTags::class);

        $this-&gt;getValidatorChain()
            -&gt;attachByName(NotEmpty::class, [
                'message' =&gt; sprintf(Message::VALIDATOR_REQUIRED_FIELD_BY_NAME, 'author'),
            ], true);
    }
}</code></pre>
<ul>
<li><code>src/Book/src/InputFilter/Input/NameInput.php</code></li>
</ul>
<pre class="highlight"><code class="language-php">&lt;?php

declare(strict_types=1);

namespace Api\Book\InputFilter\Input;

use Api\App\Message;
use Laminas\Filter\StringTrim;
use Laminas\Filter\StripTags;
use Laminas\InputFilter\Input;
use Laminas\Validator\NotEmpty;

class NameInput extends Input
{
    public function __construct(?string $name = null, bool $isRequired = true)
    {
        parent::__construct($name);

        $this-&gt;setRequired($isRequired);

        $this-&gt;getFilterChain()
            -&gt;attachByName(StringTrim::class)
            -&gt;attachByName(StripTags::class);

        $this-&gt;getValidatorChain()
            -&gt;attachByName(NotEmpty::class, [
                'message' =&gt; sprintf(Message::VALIDATOR_REQUIRED_FIELD_BY_NAME, 'name'),
            ], true);
    }
}</code></pre>
<ul>
<li><code>src/Book/src/InputFilter/Input/ReleaseDateInput.php</code></li>
</ul>
<pre class="highlight"><code class="language-php">&lt;?php

declare(strict_types=1);

namespace Api\Book\InputFilter\Input;

use Api\App\Message;
use Laminas\Filter\StringTrim;
use Laminas\Filter\StripTags;
use Laminas\InputFilter\Input;
use Laminas\Validator\Date;
use Laminas\Validator\NotEmpty;

class ReleaseDateInput extends Input
{
    public function __construct(?string $name = null, bool $isRequired = true)
    {
        parent::__construct($name);

        $this-&gt;setRequired($isRequired);

        $this-&gt;getFilterChain()
            -&gt;attachByName(StringTrim::class)
            -&gt;attachByName(StripTags::class);

        $this-&gt;getValidatorChain()
            -&gt;attachByName(Date::class, [
                'message' =&gt; sprintf(Message::INVALID_VALUE, 'releaseDate'),
            ], true);
    }
}</code></pre>
<ul>
<li><code>src/Book/src/Handler/BookHandler.php</code></li>
</ul>
<pre class="highlight"><code class="language-php">&lt;?php

declare(strict_types=1);

namespace Api\Book\Handler;

use Api\App\Handler\ResponseTrait;
use Api\Book\InputFilter\BookInputFilter;
use Api\Book\Service\BookServiceInterface;
use Mezzio\Hal\HalResponseFactory;
use Mezzio\Hal\ResourceGenerator;
use Psr\Http\Message\ResponseInterface;
use Psr\Http\Message\ServerRequestInterface;
use Psr\Http\Server\RequestHandlerInterface;
use Dot\AnnotatedServices\Annotation\Inject;

class BookHandler implements RequestHandlerInterface
{
    use ResponseTrait;

    /**
     * @Inject({
     *     HalResponseFactory::class,
     *     ResourceGenerator::class,
     *     BookServiceInterface::class
     * })
     */
    public function __construct(
        protected HalResponseFactory $responseFactory,
        protected ResourceGenerator $resourceGenerator,
        protected BookServiceInterface $bookService
    ) {
    }

    public function get(ServerRequestInterface $request): ResponseInterface
    {
        $books = $this-&gt;bookService-&gt;getBooks($request-&gt;getQueryParams());

        return $this-&gt;createResponse($request, $books);
    }

    public function post(ServerRequestInterface $request): ResponseInterface
    {
        $inputFilter = (new BookInputFilter())-&gt;setData($request-&gt;getParsedBody());
        if (! $inputFilter-&gt;isValid()) {
            return $this-&gt;errorResponse($inputFilter-&gt;getMessages());
        }

        $book = $this-&gt;bookService-&gt;createBook($inputFilter-&gt;getValues());

        return $this-&gt;createResponse($request, $book);
    }
}</code></pre>
<h2 id="configuring-and-registering-the-new-module">Configuring and registering the new module</h2>
<p>Once you set up all the files as in the example above, you will need to do a few additional configurations:</p>
<ul>
<li>register the namespace by adding this line <code>"Api\\Book\\": "src/Book/src/",</code> in <code>composer.json</code> under the <code>autoload.psr-4</code> key</li>
<li>register the module by adding <code>Api\Book\ConfigProvider::class,</code> under <code>Api\User\ConfigProvider::class,</code></li>
<li>register the module's routes by adding <code>\Api\Book\RoutesDelegator::class,</code> under <code>\Api\User\RoutesDelegator::class,</code> in <code>src/App/src/ConfigProvider.php</code></li>
<li>update Composer autoloader by running the command:</li>
</ul>
<pre class="highlight"><code class="language-shell">composer dump-autoload</code></pre>
<p>It should look like this:</p>
<pre class="highlight"><code class="language-php">public function getDependencies(): array
{
    return [
        'delegators' =&gt; [
            Application::class =&gt; [
                RoutesDelegator::class,
                \Api\Admin\RoutesDelegator::class,
                \Api\User\RoutesDelegator::class,
                \Api\Book\RoutesDelegator::class,
            ],
        ],
        'factories'  =&gt; [
            ...
        ]
        ...</code></pre>
<ul>
<li>In <code>src/config/autoload/doctrine.global.php</code> add this under the <code>doctrine.driver</code> key:</li>
</ul>
<pre class="highlight"><code class="language-php">'BookEntities'  =&gt; [
    'class' =&gt; AttributeDriver::class,
    'cache' =&gt; 'array',
    'paths' =&gt; __DIR__ . '/../../src/Book/src/Entity',
],</code></pre>
<ul>
<li><code>Api\\Book\Entity'    =&gt; 'BookEntities',</code> add this under the <code>doctrine.driver.drivers</code> key</li>
</ul>
<p>Example:</p>
<pre class="highlight"><code class="language-php">&lt;?php
...
return [
    'doctrine'            =&gt; [
        ...
        'driver'        =&gt; [
            'orm_default'   =&gt; [
                'class'   =&gt; MappingDriverChain::class,
                'drivers' =&gt; [
                    'Api\\App\Entity'    =&gt; 'AppEntities',
                    'Api\\Admin\\Entity' =&gt; 'AdminEntities',
                    'Api\\User\\Entity'  =&gt; 'UserEntities',
                    'Api\\Book\Entity'    =&gt; 'BookEntities',
                ],
            ],
            'AdminEntities' =&gt; [
                'class' =&gt; AttributeDriver::class,
                'cache' =&gt; 'array',
                'paths' =&gt; __DIR__ . '/../../src/Admin/src/Entity',
            ],
            'UserEntities'  =&gt; [
                'class' =&gt; AttributeDriver::class,
                'cache' =&gt; 'array',
                'paths' =&gt; __DIR__ . '/../../src/User/src/Entity',
            ],
            'AppEntities'   =&gt; [
                'class' =&gt; AttributeDriver::class,
                'cache' =&gt; 'array',
                'paths' =&gt; __DIR__ . '/../../src/App/src/Entity',
            ],
            'BookEntities'  =&gt; [
                'class' =&gt; AttributeDriver::class,
                'cache' =&gt; 'array',
                'paths' =&gt; __DIR__ . '/../../src/Book/src/Entity',
            ],
        ],
        ...</code></pre>
<p>Next we need to configure access to the newly created endpoints, add <code>books.list</code> and <code>book.create</code> to the authorization rbac array, under the <code>UserRole::ROLE_GUEST</code> key.</p>
<blockquote>
<p>Make sure you read and understand the rbac documentation.</p>
</blockquote>
<h2 id="migrations">Migrations</h2>
<p>We created the <code>Book</code> entity, but we didn't create the associated table for it.</p>
<p>Doctrine can handle the table creation, run the following command:</p>
<pre class="highlight"><code class="language-shell">vendor/bin/doctrine-migrations diff --filter-expression='/^(?!oauth_)/'</code></pre>
<p>This will check for differences between your entities and database structure and create migration files if necessary, in <code>data/doctrine/migrations</code>.</p>
<p>To execute the migrations run:</p>
<pre class="highlight"><code class="language-shell">vendor/bin/doctrine-migrations migrate</code></pre>
<h2 id="checking-endpoints">Checking endpoints</h2>
<p>If we did everything as planned we can call the <code>http://0.0.0.0:8080/book</code> endpoint and create a new book:</p>
<pre class="highlight"><code class="language-shell">curl -X POST http://0.0.0.0:8080/book
  -H "Content-Type: application/json"
  -d '{"name": "test", "author": "author name", "releaseDate": "2023-03-03"}'</code></pre>
<p>To list the books use:</p>
<pre class="highlight"><code class="language-shell">curl http://0.0.0.0:8080/books</code></pre>




    <nav>
    <ul class="page-nav hidden-print">
        
        <li class="page-nav__item">
            
                <a rel="prev" class="page-nav__link page-nav__link--prev" href="../../commands/generate-tokens/">
                    <small class="page-nav__label">Previous</small>
                    <i class="bi bi-chevron-left"></i>
                    Generate tokens
                </a>
            
        </li>

        
        <li class="page-nav__item">
            
                <a rel="next" class="page-nav__link page-nav__link--next" href="../token-authentication/">
                    <small class="page-nav__label">Next</small>
                    Token authentication
                    <i class="bi bi-chevron-right"></i>
                </a>
            
        </li>
    </ul>
</nav>



                    
                </div>
            </div>
        </div>

        
        <footer class="footer">
    <div class="container">

        <div class="row">
            <div class="col-md-9">
                <div class="footer_head">
                    <p>DotKernel</p>
                </div>

                <div class="row">
                    <div class="col-md-6 dk_widget">
                        <p>DotKernel Frontend</p>
                        <a href="https://docs.dotkernel.org/frontend/" target="_blank">
                            <i class="bi bi-arrow-return-right"></i>
                            DotKernel web starter project suitable for frontend applications
                        </a>
                    </div>

                    <div class="col-md-6 dk_widget">
                        <p>DotKernel API</p>
                        <a href="https://docs.dotkernel.org/api-documentation/" target="_blank">
                            <i class="bi bi-arrow-return-right"></i>
                            DotKernel web starter project suitable for building RESTful APIs
                        </a>
                    </div>

                    <div class="col-md-6 dk_widget">
                        <p>DotKernel Admin</p>

                        <a href="https://docs.dotkernel.org/admin/" target="_blank">
                            <i class="bi bi-arrow-return-right"></i>
                            DotKernel web starter project suitable for admin applications
                        </a>
                    </div>

                    <div class="col-md-6 dk_widget">
                        <p>DotKernel Packages</p>
                        <a href="https://docs.dotkernel.org/packages/" target="_blank">
                            <i class="bi bi-arrow-return-right"></i>
                            DotKernel packages offering a wide range of tools
                        </a>
                    </div>
                </div>

            </div>

            <div class="col-md-3">
                <div class="footer_head">
                    <p>Support</p>
                </div>
                <ul class="support__list">
                    <li class="support__list-item">
                        <a href="https://github.com/dotkernel" class="support__link" title="GitHub" target="_blank">
                            <i class="bi bi-github"></i> GitHub
                        </a>
                    </li>
                    <li class="support__list-item">
                        <a href="https://dotkernel.slack.com" class="support__link" title="Slack" target="_blank">
                            <i class="bi bi-slack"></i> Slack
                        </a>
                    </li>
                    <li class="support__list-item">
                        <a href="https://twitter.com/dotkernel" class="support__link" title="X (Twitter)" target="_blank">
                            <i class="bi bi-twitter-x"></i> Twitter
                        </a>
                    </li>

                    <li class="support__list-item">
                        <a href="https://www.dotkernel.com/blog/" class="support__link" title="Blog" target="_blank">
                            <i class="bi bi-file-post"></i> Blog
                        </a>
                    </li>
                    <li class="support__list-item">
                        <a href="https://www.dotkernel.com/feed/" class="support__link" title="Blog feed" target="_blank">
                            <i class="bi bi-rss-fill"></i> Feed
                        </a>
                    </li>
                </ul>
            </div>
        </div>

        <div class="footer_copy">
            &#169; 2024 by <a href="https://www.dotkernel.com/" target="_blank">DotKernel</a> a collection of PSR-7 Middleware applications and libraries
        </div>
    </div>
</footer>

        <script>
            let base_url = '../../..',
                project  = "api",
                siteName = 'api';

                document.addEventListener("DOMContentLoaded", function() {
                    document.querySelectorAll('.subnavigation__link').forEach(function(link) {
                        if (link.getAttribute('href') === './') {
                            link.parentNode.parentNode.classList.add('show');
                        }
                    });
                });
        </script>
<!--        -->
<!--        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Search</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search in api" id="mkdocs-search-query">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
        </div>
    </div>
</div>-->
    </body>
</html>
