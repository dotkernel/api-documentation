<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="description" content="Dotkernel API">
        
        

        
        
            
        
        <meta name="docsearch:version" content="6.0.0,latest">
        <meta name="docsearch:language" content="en">
        <meta name="docsearch:component" content="api">

        
        <link rel="canonical" href="https://docs.dotkernel.org/api-documentation/v5/tutorials/find-user-by-identity/">
        
        <link rel="shortcut icon" href="https://docs.dotkernel.org/img/dk_docs_favicon_white.svg">

        <title>Find user by identity - api - Dotkernel Documentation</title>

        <link rel="stylesheet" href="https://docs.dotkernel.org/css/bootstrap.css">
        <link rel="stylesheet" href="https://docs.dotkernel.org/css/bootstrap-icons.min.css">
        <link rel="stylesheet" href="https://docs.dotkernel.org/css/docs.css">
        <script src="https://docs.dotkernel.org//js/bootstrap.js" defer></script>
        <script src="https://docs.dotkernel.org//js/docs.js" defer></script>
        <script src="https://docs.dotkernel.org//js/scripts.js" defer></script>
    </head>
    <body data-bs-spy="scroll" data-bs-target=".toc" data-bs-offset="100">

        
        <nav class="navbar navbar-expand-lg bg-body-tertiary bg-light dk-nav py-3" data-bs-theme="light">
    <div class="container justify-content-between">
        <div class="dk-nav-icon d-flex align-items-center">
            <a class="navbar-brand" href="https://docs.dotkernel.org/">
                <img alt="Dotkernel Logo" class="d-inline-block align-text-top" height="50"
                     src="https://docs.dotkernel.org//img/dk_logomark_white.svg" width="45"/>
            </a>

            <div class="dk-nav-icon-items">
                <span style="font-size: 12px; line-height: 13px">Dotkernel Documentation</span>

                <div class="dropdown" data-bs-theme="light">
                    <span class="fw-bold dropdown-toggle dk-pkg-name" data-bs-toggle="dropdown" aria-expanded="false">API</span>
                    <ul class="dropdown-menu">
                        
                        <li class="dropdown-item bg-light">
                            <a href="https://docs.dotkernel.org/api-documentation/" class="nav-link d-flex gap-4 align-items-center">
                                <img alt="Dotkernel Logo" class="d-inline-block align-text-top" height="50" src="https://docs.dotkernel.org/img/dk_logomark.svg" width="45" />
                                <div>
                                    <span class="fw-bold d-block">API</span>
                                    <span>Dotkernel API</span>
                                </div>
                            </a>
                        </li>
                        
                        <li class="dropdown-item ">
                            <a href="https://docs.dotkernel.org/admin-documentation/" class="nav-link d-flex gap-4 align-items-center">
                                <img alt="Dotkernel Logo" class="d-inline-block align-text-top" height="50" src="https://docs.dotkernel.org/img/dk_logomark.svg" width="45" />
                                <div>
                                    <span class="fw-bold d-block">Admin</span>
                                    <span>Dotkernel Admin</span>
                                </div>
                            </a>
                        </li>
                        
                        <li class="dropdown-item ">
                            <a href="https://docs.dotkernel.org/frontend-documentation/" class="nav-link d-flex gap-4 align-items-center">
                                <img alt="Dotkernel Logo" class="d-inline-block align-text-top" height="50" src="https://docs.dotkernel.org/img/dk_logomark.svg" width="45" />
                                <div>
                                    <span class="fw-bold d-block">Frontend</span>
                                    <span>Dotkernel Frontend</span>
                                </div>
                            </a>
                        </li>
                        
                        <li class="dropdown-item ">
                            <a href="https://docs.dotkernel.org/light-documentation/" class="nav-link d-flex gap-4 align-items-center">
                                <img alt="Dotkernel Logo" class="d-inline-block align-text-top" height="50" src="https://docs.dotkernel.org/img/dk_logomark.svg" width="45" />
                                <div>
                                    <span class="fw-bold d-block">Light</span>
                                    <span>Dotkernel Light</span>
                                </div>
                            </a>
                        </li>
                        
                        <li class="dropdown-item ">
                            <a href="https://docs.dotkernel.org/queue-documentation/" class="nav-link d-flex gap-4 align-items-center">
                                <img alt="Dotkernel Logo" class="d-inline-block align-text-top" height="50" src="https://docs.dotkernel.org/img/dk_logomark.svg" width="45" />
                                <div>
                                    <span class="fw-bold d-block">Queue</span>
                                    <span>Dotkernel Queue</span>
                                </div>
                            </a>
                        </li>
                        
                        <li class="dropdown-item ">
                            <a href="https://docs.dotkernel.org/packages/" class="nav-link d-flex gap-4 align-items-center">
                                <img alt="Dotkernel Logo" class="d-inline-block align-text-top" height="50" src="https://docs.dotkernel.org/img/dk_logomark.svg" width="45" />
                                <div>
                                    <span class="fw-bold d-block">Packages</span>
                                    <span>Dotkernel packages</span>
                                </div>
                            </a>
                        </li>
                        
                        <li class="dropdown-item ">
                            <a href="https://docs.dotkernel.org/development/" class="nav-link d-flex gap-4 align-items-center">
                                <img alt="Dotkernel Logo" class="d-inline-block align-text-top" height="50" src="https://docs.dotkernel.org/img/dk_logomark.svg" width="45" />
                                <div>
                                    <span class="fw-bold d-block">Development</span>
                                    <span>WSL2 Development Environment</span>
                                </div>
                            </a>
                        </li>
                        
                        <li class="dropdown-item ">
                            <a href="https://docs.dotkernel.org/headless-documentation/" class="nav-link d-flex gap-4 align-items-center">
                                <img alt="Dotkernel Logo" class="d-inline-block align-text-top" height="50" src="https://docs.dotkernel.org/img/dk_logomark.svg" width="45" />
                                <div>
                                    <span class="fw-bold d-block">Headless Platform</span>
                                    <span>Dotkernel Headless Platform</span>
                                </div>
                            </a>
                        </li>
                        
                    </ul>
                </div>
            </div>
        </div>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarText" aria-controls="navbarText" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarText">
            <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
<!--                <li class="nav-item">-->
<!--                    <a href="#" class="nav-link fw-bold text-white" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal" title="Open search">-->
<!--                        <i class="bi bi-search"></i> Search-->
<!--                    </a>-->
<!--                </li>-->
                <li class="nav-item">
                    <a class="nav-link fw-bold text-white" href="https://github.com/dotkernel/api" title="Go to api repository" target="_blank">
                        <i class="bi bi-github"></i>
                        GitHub
                    </a>
                </li>
                <li class="nav-item">
                    
    
    <div class="version-selector">
        <div class="btn-group">
            <button type="button" class="btn dropdown-toggle bg-light" data-toggle="dropdown" data-display="static" aria-haspopup="true" aria-expanded="false" id="version-selector-dropdown">
                
                    v5
                
            </button>
            <div class="dropdown-menu dropdown-menu-right dropdown-menu-lg-left" aria-labelledby="version-selector-dropdown">
                
                
                <a href="../../../v6/introduction/introduction/" class="dropdown-item">
                    
                        v6 (latest)
                    
                </a>
                
                
                
                <a href="../../introduction/introduction/" class="dropdown-item active">
                    
                        v5
                    
                </a>
                
                
                
                <a href="../../../v4/introduction/introduction/" class="dropdown-item">
                    
                        v4
                    
                </a>
                
                
            </div>
        </div>
    </div>
    

                </li>
            </ul>
        </div>
    </div>
</nav>

        
        <div class="container">
    <nav aria-label="breadcrumb" class="nav_breadcrumb">
        <ol class="breadcrumb">
            
                <li class="breadcrumb-item"><a href="https://docs.dotkernel.org/">Overview</a></li>
                

                
                    <li class="breadcrumb-item"><a href="../../..">api</a></li>

                    
                        
                            
                            
                        
                    
                        
                            
                            
                                <li class="breadcrumb-item">Tutorials</li>
                            
                        
                    

                    <li class="breadcrumb-item active" aria-current="page">Find user by identity</li>
                
            
        </ol>
    </nav>
</div>

        
        <div class="container">
            <div class="row">
                <div class="col-lg-3 right_sidebar">
                    
                    
    <div class="subnavigation hidden-print">
<!--        <h4 class="subnavigation__title">-->
<!--            <a href="../../..">api</a>-->
<!--        </h4>-->

        <h5 class="subnavigation__title">Table of Contents</h5>

        <ul class="subnavigation__list">
            

                
                

                    
                    
                
            

                
                
                    
                        
<li class="subnavigation__list-item ">
    <a href="../../introduction/introduction/" class="subnavigation__link">Introduction</a>
</li>

                    
                        



















<li class="subnavigation__list-item">
    <a data-bs-toggle="collapse" href="#overview" role="button" aria-expanded="false" aria-controls="overview">
        <span class="subnavigation__headline">Overview</span>
    </a>
    <ul class="subnavigation__list collapse" id="overview">
        
        
<li class="subnavigation__list-item ">
    <a href="../../introduction/server-requirements/" class="subnavigation__link">Server Requirements</a>
</li>

        
        
<li class="subnavigation__list-item ">
    <a href="../../introduction/file-structure/" class="subnavigation__link">File Structure</a>
</li>

        
        
<li class="subnavigation__list-item ">
    <a href="../../introduction/packages/" class="subnavigation__link">Packages</a>
</li>

        
        
<li class="subnavigation__list-item ">
    <a href="../../introduction/psr/" class="subnavigation__link">PSRs</a>
</li>

        
    </ul>
</li>

                    
                        



























<li class="subnavigation__list-item">
    <a data-bs-toggle="collapse" href="#installation" role="button" aria-expanded="false" aria-controls="installation">
        <span class="subnavigation__headline">Installation</span>
    </a>
    <ul class="subnavigation__list collapse" id="installation">
        
        
<li class="subnavigation__list-item ">
    <a href="../../installation/getting-started/" class="subnavigation__link">Getting Started</a>
</li>

        
        
<li class="subnavigation__list-item ">
    <a href="../../installation/composer/" class="subnavigation__link">Composer</a>
</li>

        
        
<li class="subnavigation__list-item ">
    <a href="../../installation/configuration-files/" class="subnavigation__link">Configuration Files</a>
</li>

        
        
<li class="subnavigation__list-item ">
    <a href="../../installation/doctrine-orm/" class="subnavigation__link">Doctrine ORM</a>
</li>

        
        
<li class="subnavigation__list-item ">
    <a href="../../installation/test-the-installation/" class="subnavigation__link">Test the Installation</a>
</li>

        
        
<li class="subnavigation__list-item ">
    <a href="../../installation/faq/" class="subnavigation__link">FAQ</a>
</li>

        
    </ul>
</li>

                    
                        





















<li class="subnavigation__list-item">
    <a data-bs-toggle="collapse" href="#upgrading" role="button" aria-expanded="false" aria-controls="upgrading">
        <span class="subnavigation__headline">Upgrading</span>
    </a>
    <ul class="subnavigation__list collapse" id="upgrading">
        
        
<li class="subnavigation__list-item ">
    <a href="../../upgrading/upgrading/" class="subnavigation__link">Upgrade procedure</a>
</li>

        
        
<li class="subnavigation__list-item ">
    <a href="../../upgrading/UPGRADE-5.3/" class="subnavigation__link">Upgrading 5.2 to 5.3</a>
</li>

        
    </ul>
</li>

                    
                        











<li class="subnavigation__list-item">
    <a data-bs-toggle="collapse" href="#flow" role="button" aria-expanded="false" aria-controls="flow">
        <span class="subnavigation__headline">Flow</span>
    </a>
    <ul class="subnavigation__list collapse" id="flow">
        
        
<li class="subnavigation__list-item ">
    <a href="../../flow/middleware-flow/" class="subnavigation__link">Middleware Flow</a>
</li>

        
        
<li class="subnavigation__list-item ">
    <a href="../../flow/default-library-flow/" class="subnavigation__link">Default Library Flow</a>
</li>

        
        
<li class="subnavigation__list-item ">
    <a href="../../flow/library-flow-for-email/" class="subnavigation__link">Library Flow for Email</a>
</li>

        
    </ul>
</li>

                    
                        





























<li class="subnavigation__list-item">
    <a data-bs-toggle="collapse" href="#core-features" role="button" aria-expanded="false" aria-controls="core-features">
        <span class="subnavigation__headline">Core Features</span>
    </a>
    <ul class="subnavigation__list collapse" id="core-features">
        
        
<li class="subnavigation__list-item ">
    <a href="../../core-features/authentication/" class="subnavigation__link">Authentication</a>
</li>

        
        
<li class="subnavigation__list-item ">
    <a href="../../core-features/authorization/" class="subnavigation__link">Authorization</a>
</li>

        
        
<li class="subnavigation__list-item ">
    <a href="../../core-features/content-validation/" class="subnavigation__link">Content Validation</a>
</li>

        
        
<li class="subnavigation__list-item ">
    <a href="../../core-features/exceptions/" class="subnavigation__link">Exceptions</a>
</li>

        
        
<li class="subnavigation__list-item ">
    <a href="../../core-features/dependency-injection/" class="subnavigation__link">Dependency Injection</a>
</li>

        
        
<li class="subnavigation__list-item ">
    <a href="../../core-features/error-reporting/" class="subnavigation__link">Error reporting</a>
</li>

        
    </ul>
</li>

                    
                        



















<li class="subnavigation__list-item">
    <a data-bs-toggle="collapse" href="#commands" role="button" aria-expanded="false" aria-controls="commands">
        <span class="subnavigation__headline">Commands</span>
    </a>
    <ul class="subnavigation__list collapse" id="commands">
        
        
<li class="subnavigation__list-item ">
    <a href="../../commands/create-admin-account/" class="subnavigation__link">Create admin account</a>
</li>

        
        
<li class="subnavigation__list-item ">
    <a href="../../commands/generate-database-migrations/" class="subnavigation__link">Generate database migrations</a>
</li>

        
        
<li class="subnavigation__list-item ">
    <a href="../../commands/display-available-endpoints/" class="subnavigation__link">Display available endpoints</a>
</li>

        
        
<li class="subnavigation__list-item ">
    <a href="../../commands/generate-tokens/" class="subnavigation__link">Generate tokens</a>
</li>

        
    </ul>
</li>

                    
                        





















<li class="subnavigation__list-item">
    <a data-bs-toggle="collapse" href="#tutorials" role="button" aria-expanded="false" aria-controls="tutorials">
        <span class="subnavigation__headline">Tutorials</span>
    </a>
    <ul class="subnavigation__list collapse" id="tutorials">
        
        
<li class="subnavigation__list-item ">
    <a href="../cors/" class="subnavigation__link">Setting up CORS</a>
</li>

        
        
<li class="subnavigation__list-item ">
    <a href="../create-book-module/" class="subnavigation__link">Creating a book module</a>
</li>

        
        
<li class="subnavigation__list-item ">
    <a href="../token-authentication/" class="subnavigation__link">Token authentication</a>
</li>

        
        
<li class="subnavigation__list-item ">
    <a href="../api-evolution/" class="subnavigation__link">API Evolution</a>
</li>

        
        
<li class="subnavigation__list-item subnavigation__list-item--active">
    <a href="./" class="subnavigation__link">Find user by identity</a>
</li>

        
    </ul>
</li>

                    
                        





















































<li class="subnavigation__list-item">
    <a data-bs-toggle="collapse" href="#transition-from-api-tools" role="button" aria-expanded="false" aria-controls="transition-from-api-tools">
        <span class="subnavigation__headline">Transition from API Tools</span>
    </a>
    <ul class="subnavigation__list collapse" id="transition-from-api-tools">
        
        
<li class="subnavigation__list-item ">
    <a href="../../transition-from-api-tools/api-tools-vs-dotkernel-api/" class="subnavigation__link">Laminas API Tools vs Dotkernel API</a>
</li>

        
        
<li class="subnavigation__list-item ">
    <a href="../../transition-from-api-tools/transition-approach/" class="subnavigation__link">Transition Approach</a>
</li>

        
        
<li class="subnavigation__list-item ">
    <a href="../../transition-from-api-tools/discovery-phase/" class="subnavigation__link">Discovery Phase</a>
</li>

        
    </ul>
</li>

                    
                        

















<li class="subnavigation__list-item">
    <a data-bs-toggle="collapse" href="#openapi" role="button" aria-expanded="false" aria-controls="openapi">
        <span class="subnavigation__headline">OpenAPI</span>
    </a>
    <ul class="subnavigation__list collapse" id="openapi">
        
        
<li class="subnavigation__list-item ">
    <a href="../../openapi/introduction/" class="subnavigation__link">Introduction</a>
</li>

        
        
<li class="subnavigation__list-item ">
    <a href="../../openapi/initialized-components/" class="subnavigation__link">Initialized Components</a>
</li>

        
        
<li class="subnavigation__list-item ">
    <a href="../../openapi/write-documentation/" class="subnavigation__link">Write Documentation</a>
</li>

        
        
<li class="subnavigation__list-item ">
    <a href="../../openapi/generate-documentation/" class="subnavigation__link">Generate Documentation</a>
</li>

        
        
<li class="subnavigation__list-item ">
    <a href="../../openapi/render-documentation/" class="subnavigation__link">Render Documentation</a>
</li>

        
        
<li class="subnavigation__list-item ">
    <a href="../../openapi/use-documentation/" class="subnavigation__link">Use Documentation</a>
</li>

        
        
<li class="subnavigation__list-item ">
    <a href="../../openapi/getting-help/" class="subnavigation__link">Getting Help</a>
</li>

        
    </ul>
</li>

                    
                        





















<li class="subnavigation__list-item">
    <a data-bs-toggle="collapse" href="#reference" role="button" aria-expanded="false" aria-controls="reference">
        <span class="subnavigation__headline">Reference</span>
    </a>
    <ul class="subnavigation__list collapse" id="reference">
        
        
<li class="subnavigation__list-item ">
    <a href="../../reference/account-anonymization/" class="subnavigation__link">Anonymize Accounts</a>
</li>

        
    </ul>
</li>

                    
                
            

                
                

                    
                    
                
            
        </ul>
    </div>

                    

                    
                    
                    
    

    
    
        <div class="toc">
            <h6 class="toc__headline">On this page</h6>
            <ul class="toc__list">
            
                <li class="toc__entry">
                    <a href="#our-goal" class="toc__link nav-link">Our goal</a>
                </li>
            
                <li class="toc__entry">
                    <a href="#what-we-have" class="toc__link nav-link">What we have</a>
                </li>
            
            </ul>
        </div>
    

                    
                </div>
                <div class="col-lg-9 main_docs">
                    
                    

    <div class="alert alert-danger alert-caution" role="alert">
        <p class="mb-0">
            The documentation you are viewing is for an older version of this component.<br>
            <a href="../../..">Switch to the latest (v6) version.</a>
        </p>
    </div>




    
    
<!--        <h2 class="chapter__headline text-black-50">Tutorials</h2>-->
    

    <h1 id="a-practical-example-find-user-by-identity">A practical example: Find user by identity</h1>
<h2 id="our-goal">Our goal</h2>
<p>Create a new endpoint that fetches a user record by its identity column.</p>
<p>We already have an endpoint that retrieves a user based on their UUID, so we can review it and create something similar.</p>
<h2 id="what-we-have">What we have</h2>
<p>Let's print out all available endpoints using :</p>
<pre class="highlight"><code class="language-shell">php ./bin/cli.php route:list</code></pre>
<p>This command will list all available endpoints, which looks like this:</p>
<pre class="highlight"><code class="language-text">+--------+---------------------------------+--------------------------------+
| Method | Name                            | Path                           |
+--------+---------------------------------+--------------------------------+
| POST   | account.activate.request        | /account/activate              |
| PATCH  | account.activate                | /account/activate/{hash}       |
| PATCH  | account.modify-password         | /account/reset-password/{hash} |
.............................................................................
.............................................................................
.............................................................................
| GET    | user.my-avatar.view             | /user/my-avatar                |
| GET    | user.role.list                  | /user/role                     |
| GET    | user.role.view                  | /user/role/{uuid}              |
| PATCH  | user.update                     | /user/{uuid}                   |
| GET    | user.view                       | /user/{uuid}                   |
+--------+---------------------------------+--------------------------------+</code></pre>
<h3 id="note">Note</h3>
<blockquote>
<p><strong>The above output is just an example.</strong></p>
<p>More info about listing available endpoints can be found in <code>../commands/display-available-endpoints.md</code>.</p>
</blockquote>
<p>The endpoint we're focusing on is the last one, <code>user.view</code>, so let's take a closer look at its functionality.</p>
<p>If we search for the route name <code>user.view</code> we will find its definition in the <code>src/User/src/RoutesDelegator.php</code> class, where all user related endpoints are found.</p>
<pre class="highlight"><code class="language-php">$app-&gt;get('/user/' . $uuid, UserHandler::class, 'user.view');</code></pre>
<p>Our route points to <code>get</code> method from <code>UserHandler</code> so let's navigate to that method.</p>
<pre class="highlight"><code class="language-php">public function get(ServerRequestInterface $request): ResponseInterface
{
    $user = $this-&gt;userService-&gt;findOneBy(['uuid' =&gt; $request-&gt;getAttribute('uuid')]);

    return $this-&gt;createResponse($request, $user);
}</code></pre>
<p>As we can see, the method will query the database for the user based on its uuid taken from the endpoint.</p>
<p>We now have an understanding of how things work and we can start to implement our own endpoint.</p>
<h3 id="implementation">Implementation</h3>
<p>We need to create a new handler that will process our request, we can call it <code>IdentityHandler</code>.</p>
<p>Create a new PHP class called <code>IdentityHandler.php</code> in <code>src/User/src/Handler</code> folder.</p>
<pre class="highlight"><code class="language-php">&lt;?php

declare(strict_types=1);

namespace Api\User\Handler;

use Api\App\Exception\BadRequestException;
use Api\App\Exception\NotFoundException;
use Api\App\Handler\HandlerTrait;
use Api\App\Message;
use Api\User\Entity\User;
use Api\User\Service\UserServiceInterface;
use Dot\DependencyInjection\Attribute\Inject;
use Mezzio\Hal\HalResponseFactory;
use Mezzio\Hal\ResourceGenerator;
use Psr\Http\Message\ResponseInterface;
use Psr\Http\Message\ServerRequestInterface;
use Psr\Http\Server\RequestHandlerInterface;

use function sprintf;

class IdentityHandler implements RequestHandlerInterface
{
    use HandlerTrait;

    #[Inject(
        HalResponseFactory::class,
        ResourceGenerator::class,
        UserServiceInterface::class,
    )]
    public function __construct(
        protected HalResponseFactory $responseFactory,
        protected ResourceGenerator $resourceGenerator,
        protected UserServiceInterface $userService,
    ) {
    }

    /**
     * @throws NotFoundException
     * @throws BadRequestException
     */
    public function get(ServerRequestInterface $request): ResponseInterface
    {
        $identity = $request-&gt;getAttribute('identity');
        if (empty($identity)) {
            throw (new BadRequestException())-&gt;setMessages([sprintf(Message::INVALID_VALUE, 'identity')]);
        }

        $user = $this-&gt;userService-&gt;findByIdentity($identity);
        if (! $user instanceof User) {
            throw new NotFoundException(Message::USER_NOT_FOUND);
        }

        return $this-&gt;createResponse($request, $user);
    }
}</code></pre>
<p>Our handler is very similar to the existing one, with some extra steps:</p>
<ul>
<li>We store the identity from the request in the <code>$identity</code> variable for later use.</li>
<li>If the identity is empty we throw a <code>BadRequestException</code> with an appropriate message.</li>
<li>If we can't find the user in the database we throw an <code>NotFoundException</code>.</li>
<li>If the record is found, we generate and return the response.</li>
</ul>
<p>The next step is to register the new handler.
To do this go to <code>src/User/src/ConfigProvider.php</code>.
In the <code>getDependencies()</code> method under the <code>factories</code> key add <code>IdentityHandler::class =&gt; AttributedServiceFactory::class,</code></p>
<p>Next, create the route in <code>src/User/src/RoutesDelegator.php</code>:</p>
<pre class="highlight"><code class="language-php">    $app-&gt;get(
        '/user/{identity}',
        IdentityHandler::class,
        'user.view.identity'
    );</code></pre>
<h3 id="note_1">Note</h3>
<blockquote>
<p>Make sure to register the endpoint as the last one to not shadow existing endpoints.</p>
</blockquote>
<p>The last step is to set permissions on the newly created route.</p>
<p>Go to <code>config/autoload/authorization.global.php</code> and add our route name (<code>user.view.identity</code>) under the <code>UserRole::ROLE_GUEST</code> key
This will give access to every user, including guests to view other accounts. (for the sake of simplicity)</p>
<h3 id="writing-tests">Writing tests</h3>
<p>Because every new piece of code should be tested we will write some tests for this endpoint also.</p>
<p>In the <code>test/Functional</code> folder create a new php class <code>IdentityTest.php</code>:</p>
<pre class="highlight"><code class="language-php">&lt;?php

namespace ApiTest\Functional;

use Api\App\Message;

class IdentityTest extends AbstractFunctionalTest
{
    public function testEmptyIdentityReturnsNotFound(): void
    {
        $response = $this-&gt;get('/user/');

        $this-&gt;assertResponseNotFound($response);
    }

    public function testInvalidIdentityReturnsNotFound(): void
    {
        $response = $this-&gt;get('/user/invalid_identity');
        $messages = json_decode($response-&gt;getBody()-&gt;getContents(), true);

        $this-&gt;assertResponseNotFound($response);
        $this-&gt;assertNotEmpty($messages);
        $this-&gt;assertIsArray($messages);
        $this-&gt;assertNotEmpty($messages['error']['messages'][0]);
        $this-&gt;assertIsString($messages['error']['messages'][0]);
        $this-&gt;assertSame(Message::USER_NOT_FOUND, $messages['error']['messages'][0]);
    }

    public function testValidIdentityReturnsUser(): void
    {
        $this-&gt;createUser([
            'identity' =&gt; 'valid_user',
        ]);

        $response = $this-&gt;get('/user/valid_user');

        $this-&gt;assertResponseOk($response);
        $user = json_decode($response-&gt;getBody()-&gt;getContents(), true);

        $this-&gt;assertSame('valid_user', $user['identity']);
    }
}</code></pre>
<p>Planning and coding a new feature can be challenging at times, but reviewing our existing code or tutorials can serve as a source of inspiration.</p>




    <nav>
    <ul class="list-unstyled page-nav row w-100 mt-5 mb-3 pt-5 pb-3">
        
        <li class="col text-nowrap text-md-start">
            
                <a rel="prev" class="page-nav__link page-nav__link--prev" href="../api-evolution/">
                    <i class="bi bi-chevron-left"></i>
                    API Evolution
                </a>
            
        </li>

        
        <li class="col text-nowrap text-md-end pe-0">
            
                <a rel="next" class="page-nav__link page-nav__link--next" href="../../transition-from-api-tools/api-tools-vs-dotkernel-api/">
                    Laminas API Tools vs Dotkernel API
                    <i class="bi bi-chevron-right"></i>
                </a>
            
        </li>
    </ul>
</nav>



                    
                </div>
            </div>
        </div>

        
        <footer class="footer">
    <div class="container">
        <hr class="mb-5" />

        <div class="row">
            <div class="col-md-9">
                <div class="row">
                    <div class="col-lg-4 col-md-6 dk_widget">
                        <p class="ms-0">API</p>

                        <a href="https://docs.dotkernel.org/api-documentation/">
                            <i class="bi bi-arrow-return-right"></i>
                            Dotkernel web starter project suitable for building RESTful APIs
                        </a>
                    </div>

                    <div class="col-lg-4 col-md-6 dk_widget">
                        <p class="ms-0">Admin</p>

                        <a href="https://docs.dotkernel.org/admin-documentation/">
                            <i class="bi bi-arrow-return-right"></i>
                            Dotkernel web starter project suitable for admin applications
                        </a>
                    </div>

                    <div class="col-lg-4 col-md-6 dk_widget">
                        <p class="ms-0">Frontend</p>

                        <a href="https://docs.dotkernel.org/frontend-documentation/">
                            <i class="bi bi-arrow-return-right"></i>
                            Dotkernel web starter project suitable for frontend applications
                        </a>
                    </div>

                    <div class="col-lg-4 col-md-6 dk_widget">
                        <p class="ms-0">Light</p>

                        <a href="https://docs.dotkernel.org/light-documentation/">
                            <i class="bi bi-arrow-return-right"></i>
                            Dotkernel web starter project suitable for generating a simple website
                        </a>
                    </div>

                    <div class="col-lg-4 col-md-6 dk_widget">
                        <p class="ms-0">Dotkernel Packages</p>

                        <a href="https://docs.dotkernel.org/packages/">
                            <i class="bi bi-arrow-return-right"></i>
                            Dotkernel packages offering a wide range of tools
                        </a>
                    </div>

                    <div class="col-lg-4 col-md-6 dk_widget">
                        <p class="ms-0">Development environment</p>

                        <a href="https://docs.dotkernel.org/development/">
                            <i class="bi bi-arrow-return-right"></i>
                            Install PHP, Apache, MariaDB, Composer, PhpMyAdmin, Node.js and Git on WSL2
                        </a>
                    </div>
                </div>
            </div>

            <div class="col-md-3 pt-3 mt-1">
                <ul class="support__list row">
                    <li class="support__list-item col-lg-6 mb-md-3">
                        <a href="https://github.com/dotkernel" class="support__link" title="GitHub" target="_blank">
                            <i class="bi bi-github"></i> GitHub
                        </a>
                    </li>
                    <li class="support__list-item col-lg-6 mb-md-3">
                        <a href="https://dotkernel.slack.com" class="support__link" title="Chat" target="_blank">
                            <i class="bi bi-slack"></i> Slack
                        </a>
                    </li>
                    <li class="support__list-item col-lg-6 mb-md-3">
                        <a href="https://twitter.com/dotkernel" class="support__link" title="X (Twitter)" target="_blank">
                            <i class="bi bi-twitter-x"></i> Twitter
                        </a>
                    </li>
                    <li class="support__list-item col-lg-6 mb-md-3">
                        <a href="https://www.dotkernel.com/blog/" class="support__link" title="Blog" target="_blank">
                            <i class="bi bi-file-post"></i> Blog
                        </a>
                    </li>
                    <li class="support__list-item col-lg-6 mb-md-3">
                        <a href="https://www.dotkernel.com/feed/" class="support__link" title="Blog feed" target="_blank">
                            <i class="bi bi-rss-fill"></i> Feed
                        </a>
                    </li>
                </ul>
            </div>
        </div>

        <hr class="mt-5" />

        <div class="footer_copy">
            &#169; Copyright Dotkernel 2024. All rights reserved.
        </div>
    </div>
</footer>

        <script>
            let base_url = '../../..',
                project  = "api",
                siteName = 'api';

                document.addEventListener("DOMContentLoaded", function() {
                    document.querySelectorAll('.subnavigation__link').forEach(function(link) {
                        if (link.getAttribute('href') === './') {
                            link.parentNode.parentNode.classList.add('show');
                        }
                    });
                });
        </script>
<!--        -->
<!--        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Search</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search in api" id="mkdocs-search-query">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
        </div>
    </div>
</div>-->
    </body>
</html>
